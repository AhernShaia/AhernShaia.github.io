<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>åœ¨ html.erbæª”æ¡ˆ æç¤º tailwindCSSèªæ³•</title>
    <link href="/2023/04/06/rails/tailwindinhtmlerb/"/>
    <url>/2023/04/06/rails/tailwindinhtmlerb/</url>
    
    <content type="html"><![CDATA[<hr><span id="more"></span><p>å®‰è£äº†<code>tailwindCSS</code>ï¼Œå¯æ˜¯èªæ³•å¥½å¤šæ€éº¼è¾¦ï¼Ÿï¼ï¼Œæ’ä»¶ä¹Ÿä¸æ”¯æ´<code>html.erb</code>ï¼Œåªå¥½è‡ªå·±è¨­å®šäº†ï¼ï¼</p><h3 id="Step-1-æ‰“é–‹-settings-json"><a href="#Step-1-æ‰“é–‹-settings-json" class="headerlink" title="Step 1. æ‰“é–‹ settings.json"></a><strong>Step 1. æ‰“é–‹ settings.json</strong></h3><blockquote><p>macï¼š<code>command + P</code></p><p>windowsï¼š<code>alt + P</code></p></blockquote><h3 id="Step-2-è¨­å®š-settings-json"><a href="#Step-2-è¨­å®š-settings-json" class="headerlink" title="Step 2. è¨­å®š settings.json"></a><strong>Step 2. è¨­å®š settings.json</strong></h3><p>æ‰“é–‹è¼¸å…¥æ¡†ï¼Œè¼¸å…¥ <code>&gt;open user settings(json)</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs json">#**settings.json**<br><br><span class="hljs-attr">&quot;tailwindCSS.includeLanguages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;javascript&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;javascript&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;html&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;html&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;erb&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;html&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;tailwindCSS.emmetCompletions&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;files.associations&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;*.html.erb&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;erb&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>  <span class="hljs-attr">&quot;emmet.includeLanguages&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;*.html.erb&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;html&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;erb&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;html&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å°ç§˜ç¬ˆ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ruby on rails</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è³‡æ–™è¡¨é—œè¯</title>
    <link href="/2023/04/03/rails/%E8%B3%87%E6%96%99%E8%A1%A8%E9%97%9C%E8%81%AF/"/>
    <url>/2023/04/03/rails/%E8%B3%87%E6%96%99%E8%A1%A8%E9%97%9C%E8%81%AF/</url>
    
    <content type="html"><![CDATA[<hr><span id="more"></span><h1 id="è³‡æ–™è¡¨é—œè¯"><a href="#è³‡æ–™è¡¨é—œè¯" class="headerlink" title="è³‡æ–™è¡¨é—œè¯"></a>è³‡æ–™è¡¨é—œè¯</h1><p>Model å±¤çš„é—œè¯<strong>ä¸¦ä¸æ˜¯</strong>è³‡æ–™åº«è£¡ Table çš„é—œè¯ï¼Œè€Œæ˜¯é€é ORM çš„æ–¹å¼å°‡å…©å¼µä¸åŒçš„ Table å»ºç«‹é—œä¿‚ï¼Œmodel è¢«é—œè¯ä¹‹å¾Œï¼Œå°±å¯ä»¥é€æ–¹æ³•å»å‘¼å«å°æ–¹çš„è³‡æ–™ã€‚</p><h1 id="1-å°-1ï¼šhas-one"><a href="#1-å°-1ï¼šhas-one" class="headerlink" title="1 å° 1ï¼šhas_one"></a>1 å° 1ï¼šhas_one</h1><p>has_one ç°¡å–®ä¾†èªªå°‡å…©å€‹ï¼­ odel ä¹‹é–“å»ºç«‹ä¸€å°ä¸€çš„é—œä¿‚ï¼Œ</p><p>ä»¥ä¸‹ä»¥æœƒå“¡å’Œè³¼ç‰©è»Šçš„æ¡ˆä¾‹ä½œç‚ºç·´ç¿’ï¼š</p><p><img src="/img/%E8%B3%87%E6%96%99%E8%A1%A8%E9%97%9C%E8%81%AF/Untitled.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p><h2 id="å»ºç«‹å…©å€‹-Model"><a href="#å»ºç«‹å…©å€‹-Model" class="headerlink" title="å»ºç«‹å…©å€‹ Model"></a>å»ºç«‹å…©å€‹ Model</h2><aside>ğŸš§<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-comment"># Member</span><br>rails g model <span class="hljs-title class_">Member</span> name <span class="hljs-symbol">age:</span>integer address phone email<br></code></pre></td></tr></table></figure><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-comment"># Cart</span><br><span class="hljs-comment"># member:references æœƒç”¢ç”Ÿ member_id çš„æ¬„ä½å»å°æ‡‰ member</span><br>rails g model <span class="hljs-title class_">Cart</span> <span class="hljs-symbol">price:</span>integer state <span class="hljs-symbol">amount:</span>integer <span class="hljs-symbol">member:</span>references<br></code></pre></td></tr></table></figure></aside><hr><h2 id="åœ¨å°æ‡‰çš„æª”æ¡ˆåŠ å…¥é—œè¯"><a href="#åœ¨å°æ‡‰çš„æª”æ¡ˆåŠ å…¥é—œè¯" class="headerlink" title="åœ¨å°æ‡‰çš„æª”æ¡ˆåŠ å…¥é—œè¯"></a>åœ¨å°æ‡‰çš„æª”æ¡ˆåŠ å…¥é—œè¯</h2><aside>ğŸš§<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-comment">#  models/member</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Member</span> &lt; <span class="hljs-title class_ inherited__">ApplicationRecord</span><br>    has_one <span class="hljs-symbol">:cart</span><br><span class="hljs-comment"># åŠ ä¸Šé—œè¯å¾Œï¼Œè©²modelæœƒå»ºç«‹ä»¥ä¸‹å…©å€‹æ–¹æ³•</span><br><span class="hljs-comment"># cart</span><br><span class="hljs-comment"># cart=</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-comment">#  models/cart</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Cart</span> &lt; <span class="hljs-title class_ inherited__">ApplicationRecord</span><br>  belongs_to <span class="hljs-symbol">:member</span><br><span class="hljs-comment"># belongs_toæœƒå»ºç«‹ä»¥ä¸‹å››ç¨®æ–¹æ³•</span><br><span class="hljs-comment"># member  &lt;- æŸ¥è©¢</span><br><span class="hljs-comment"># member= &lt;- è³¦å€¼</span><br><span class="hljs-comment"># create_member &lt;- ä»¥cartçš„è§’åº¦å»ºç«‹æœƒå“¡(ç›¸ç•¶æ–¼[**new**]ï¼Œé€é.saveå¯«å…¥DB)</span><br><span class="hljs-comment"># build_member  &lt;- ä»¥cartçš„è§’åº¦å»ºç«‹æœƒå“¡</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure><aside>â— å¦‚æœcartæ²’æœ‰é™„å±¬çš„è©±ï¼Œç„¡æ³•å¯«å…¥DB</aside></aside><h3 id="1-rails-console-æ¸¬è©¦-â€”-rails-console-â€“sandbox"><a href="#1-rails-console-æ¸¬è©¦-â€”-rails-console-â€“sandbox" class="headerlink" title="1. rails console æ¸¬è©¦ â€” rails console â€“sandbox"></a>1. rails console æ¸¬è©¦ â€” <strong>rails console â€“sandbox</strong></h3><ol><li><p>å»ºç«‹ä¸€ä½æœƒå“¡è³‡æ–™</p><aside>ğŸš§ newæ–¹æ³•åªæ˜¯å­˜åœ¨è¨˜æ†¶é«”ä¸­ï¼Œé‚„è¦ä½¿ç”¨ .save æ‰æœƒå¯«é€²è³‡æ–™åº«ã€‚<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby">m1 = <span class="hljs-title class_">Member</span>.new(<span class="hljs-symbol">name:</span> <span class="hljs-string">&quot;shary&quot;</span>, <span class="hljs-symbol">age:</span> <span class="hljs-number">22</span>)<br></code></pre></td></tr></table></figure><p><img src="/img/%E8%B3%87%E6%96%99%E8%A1%A8%E9%97%9C%E8%81%AF/Untitled%201.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p></aside></li><li><p>å»ºç«‹ä¸€å°è³¼ç‰©è»Š</p><aside>ğŸš§<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby">c1 = <span class="hljs-title class_">Cart</span>.new(<span class="hljs-symbol">price:</span> <span class="hljs-number">355</span>, <span class="hljs-symbol">state:</span> <span class="hljs-string">&quot;unpaid&quot;</span>)<br></code></pre></td></tr></table></figure><p><img src="/img/%E8%B3%87%E6%96%99%E8%A1%A8%E9%97%9C%E8%81%AF/Untitled%202.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p></aside></li><li><p>ç•¶é€™ç­†è³¼ç‰©è»Šçš„è³‡æ–™è¦å¯«é€²è³‡æ–™åº«çš„æ™‚å€™ï¼Œæœƒå‡ºç¾ falseï¼ŒåŸå› æ˜¯åœ¨ models&#x2F;cart.rb å»ºç«‹é—œè¯æ™‚ï¼Œ<strong>å¿…é ˆ</strong>è¦å¡«å…¥ member_id</p><aside>ğŸš§<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby">c1.save<br></code></pre></td></tr></table></figure><p><img src="/img/%E8%B3%87%E6%96%99%E8%A1%A8%E9%97%9C%E8%81%AF/Untitled%203.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p><p>ä½¿ç”¨ &#96;.**errors.full_messages æ–¹æ³•æŸ¥çœ‹éŒ¯èª¤è³‡è¨Š</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby">c1.errors.full_messages<br></code></pre></td></tr></table></figure><p><img src="/img/%E8%B3%87%E6%96%99%E8%A1%A8%E9%97%9C%E8%81%AF/Untitled%204.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p></aside></li><li><p>å°‡è³¼ç‰©è»Šçš„ member_id æŒ‡å®šçµ¦ member</p><aside>ğŸš§<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby">c1.member = m1<br></code></pre></td></tr></table></figure><p><img src="/img/%E8%B3%87%E6%96%99%E8%A1%A8%E9%97%9C%E8%81%AF/Untitled%205.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p></aside></li><li><p>ç•¶ member_id æœ‰å€¼ä¹‹å¾Œï¼Œå°±å¯ä»¥é€²è¡Œ save</p><aside>ğŸš§ å¯ä»¥çœ‹åˆ°è³‡æ–™å·²ç¶“æˆåŠŸå¯«å…¥<p><img src="/img/%E8%B3%87%E6%96%99%E8%A1%A8%E9%97%9C%E8%81%AF/Untitled%206.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p></aside></li></ol><h3 id="æ›å€‹è§’åº¦ï¼šä»¥-cart-çš„è§’åº¦å»ºç«‹-member"><a href="#æ›å€‹è§’åº¦ï¼šä»¥-cart-çš„è§’åº¦å»ºç«‹-member" class="headerlink" title="æ›å€‹è§’åº¦ï¼šä»¥ cart çš„è§’åº¦å»ºç«‹ member"></a>æ›å€‹è§’åº¦ï¼šä»¥ cart çš„è§’åº¦å»ºç«‹ member</h3><ol><li><p>å»ºç«‹ä¸€å°è³¼ç‰©è»Š c2</p><aside>ğŸš§<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby">c2 = <span class="hljs-title class_">Cart</span>.new(<span class="hljs-symbol">price:</span> <span class="hljs-number">768</span>, <span class="hljs-symbol">state:</span> <span class="hljs-string">&quot;paid&quot;</span>)<br></code></pre></td></tr></table></figure><p><img src="/img/%E8%B3%87%E6%96%99%E8%A1%A8%E9%97%9C%E8%81%AF/Untitled%207.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p></aside></li><li><p>é€é c2 çš„è§’åº¦æ–°å¢ä¸€ä½ member</p><aside>ğŸš§<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby">c2.create_member(<span class="hljs-symbol">id:</span> <span class="hljs-number">9567</span>, <span class="hljs-symbol">name:</span> <span class="hljs-string">&quot;warsaw&quot;</span>)<br></code></pre></td></tr></table></figure><p>æ–°å¢å®Œå¾Œï¼Œå†ä½¿ç”¨ save å¯«å…¥è³‡æ–™åº«</p><p><img src="/img/%E8%B3%87%E6%96%99%E8%A1%A8%E9%97%9C%E8%81%AF/Untitled%208.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p></aside></li><li><p>æŸ¥çœ‹è³¼ç‰©è»Šçš„æœƒå“¡</p><aside>ğŸš§<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby">c2.member<br></code></pre></td></tr></table></figure><p><img src="/img/%E8%B3%87%E6%96%99%E8%A1%A8%E9%97%9C%E8%81%AF/Untitled%209.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p></aside></li></ol><hr><h1 id="1-å°å¤šï¼šhas-many"><a href="#1-å°å¤šï¼šhas-many" class="headerlink" title="1 å°å¤šï¼šhas_many"></a>1 å°å¤šï¼šhas_many</h1><p>å»ºç«‹ä¸€å°å¤šçš„é—œä¿‚ï¼Œä¾‹å¦‚ï¼šä¸€å°è³¼ç‰©è»Šæœ‰å¤šå€‹å•†å“ã€‚</p><h3 id="å†å»ºç«‹ä¸€å€‹-Model"><a href="#å†å»ºç«‹ä¸€å€‹-Model" class="headerlink" title="å†å»ºç«‹ä¸€å€‹ Model"></a>å†å»ºç«‹ä¸€å€‹ Model</h3><p>æ‰¿æ¥ä¸Šé¢çš„ç¤ºä¾‹ï¼š</p><aside>ğŸš§ Productï¼š<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby">rails g model <span class="hljs-title class_">Product</span> name <span class="hljs-symbol">price:</span>integer<br></code></pre></td></tr></table></figure></aside><h3 id="åŠ å…¥é—œè¯"><a href="#åŠ å…¥é—œè¯" class="headerlink" title="åŠ å…¥é—œè¯"></a>åŠ å…¥é—œè¯</h3><aside>ğŸš§<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-comment"># models/product</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Product</span> &lt; <span class="hljs-title class_ inherited__">ApplicationRecord</span><br>  belongs_to <span class="hljs-symbol">:cart</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-comment"># models/cart</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Cart</span> &lt; <span class="hljs-title class_ inherited__">ApplicationRecord</span><br>  belongs_to <span class="hljs-symbol">:member</span><br><br>has_many <span class="hljs-symbol">:products</span> &lt;== +-----+<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure></aside><h3 id="å»ºç«‹å…©ç­†-product-è³‡æ–™"><a href="#å»ºç«‹å…©ç­†-product-è³‡æ–™" class="headerlink" title="å»ºç«‹å…©ç­† product è³‡æ–™"></a>å»ºç«‹å…©ç­† product è³‡æ–™</h3><aside>ğŸš§<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ruby">p1 = <span class="hljs-title class_">Product</span>.new(<span class="hljs-symbol">name:</span> <span class="hljs-string">&#x27;æ›²å¥‡&#x27;</span>, <span class="hljs-symbol">price:</span> <span class="hljs-number">10</span>)<br>p2 = <span class="hljs-title class_">Product</span>.new(<span class="hljs-symbol">name:</span> <span class="hljs-string">&#x27;ç´…èŒ¶&#x27;</span>, <span class="hljs-symbol">price:</span> <span class="hljs-number">20</span>)<br></code></pre></td></tr></table></figure></aside><h3 id="å°‡-p1-p2-è³‡æ–™æ”¾å…¥-cart"><a href="#å°‡-p1-p2-è³‡æ–™æ”¾å…¥-cart" class="headerlink" title="å°‡ p1,p2 è³‡æ–™æ”¾å…¥ cart"></a>å°‡ p1,p2 è³‡æ–™æ”¾å…¥ cart</h3><aside>ğŸš§<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ruby">c2.products = [p1, p2]<br><span class="hljs-comment">#  c2.products &lt;&lt; [p1, p2]</span><br></code></pre></td></tr></table></figure></aside><h3 id="æŸ¥çœ‹-c2-è£¡çš„-products"><a href="#æŸ¥çœ‹-c2-è£¡çš„-products" class="headerlink" title="æŸ¥çœ‹ c2 è£¡çš„ products"></a>æŸ¥çœ‹ c2 è£¡çš„ products</h3><aside>ğŸš§ p1, p2 éƒ½æ”¾å…¥cartäº†<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby">c2.products<br></code></pre></td></tr></table></figure><p><img src="/img/%E8%B3%87%E6%96%99%E8%A1%A8%E9%97%9C%E8%81%AF/Untitled%2010.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p></aside><hr><h1 id="å¤šå°å¤š"><a href="#å¤šå°å¤š" class="headerlink" title="å¤šå°å¤š"></a>å¤šå°å¤š</h1><p>é€éç¬¬ä¸‰å¼µ Table å»ºç«‹å…¶ä»– Table ä¹‹é–“çš„é—œè¯ï¼Œ</p><p>ä¾‹å¦‚ï¼šä¸€é–“åº—æœ‰å¤šå€‹å•†å“ï¼Œå•†å“ä¹Ÿå¯ä»¥åœ¨å¤šå€‹å•†åº—è²©ã€‚</p><h3 id="å»ºç«‹-Model"><a href="#å»ºç«‹-Model" class="headerlink" title="å»ºç«‹ Model:"></a>å»ºç«‹ Model:</h3><p><img src="/img/%E8%B3%87%E6%96%99%E8%A1%A8%E9%97%9C%E8%81%AF/Untitled%2011.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p><aside>ğŸš§ å»ºç«‹ç¬¬ä¸‰å¼µTable **WareHouse** é—œè¯ store å’Œ product<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-comment"># WareHouse</span><br>rails g model <span class="hljs-title class_">WareHouse</span> <span class="hljs-symbol">store:</span>references <span class="hljs-symbol">product:</span>references<br></code></pre></td></tr></table></figure></aside><aside>ğŸš§<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-comment"># models/warehouse</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">WareHouse</span> &lt; <span class="hljs-title class_ inherited__">ApplicationRecord</span><br>  belongs_to <span class="hljs-symbol">:store</span><br>  belongs_to <span class="hljs-symbol">:product</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-comment"># models/store</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Store</span> &lt; <span class="hljs-title class_ inherited__">ApplicationRecord</span><br>  has_many <span class="hljs-symbol">:ware_houses</span> &lt;== +----+<br>has_many <span class="hljs-symbol">:products</span>, <span class="hljs-symbol">through:</span> <span class="hljs-symbol">:ware_houses</span> &lt;== +----+<br><span class="hljs-comment"># é€™å¼µè¡¨é—œè¯äº†productï¼Œè¡¨ç¤ºæœ‰å®ƒå¾ˆå¤šå•†å“ï¼Œè¦é€é **:ware_house** å»ºç«‹å…©è€…ä¹‹é–“çš„é—œä¿‚æŸ¥è©¢</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-comment"># models/product</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Product</span> &lt; <span class="hljs-title class_ inherited__">ApplicationRecord</span><br>  has_many <span class="hljs-symbol">:ware_houses</span> &lt;== +----+<br>  has_many <span class="hljs-symbol">:stores</span>, <span class="hljs-symbol">through:</span> <span class="hljs-symbol">:ware_houses</span> &lt;== +----+<br><span class="hljs-comment"># é€™å¼µè¡¨é—œè¯äº†storeï¼Œè¡¨ç¤ºæœ‰å®ƒå¾ˆå¤šå•†åº—ï¼Œè¦é€é **:ware_house** å»ºç«‹å…©è€…ä¹‹é–“çš„é—œä¿‚æŸ¥è©¢</span><br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure></aside><h3 id="å ´æ™¯ï¼šæœ‰å…©é–“åº—ï¼Œ3-ç¨®å•†å“ï¼Œå…¶ä¸­ä¸€é–“åº—åªè³£å…©ç¨®å•†å“"><a href="#å ´æ™¯ï¼šæœ‰å…©é–“åº—ï¼Œ3-ç¨®å•†å“ï¼Œå…¶ä¸­ä¸€é–“åº—åªè³£å…©ç¨®å•†å“" class="headerlink" title="å ´æ™¯ï¼šæœ‰å…©é–“åº—ï¼Œ3 ç¨®å•†å“ï¼Œå…¶ä¸­ä¸€é–“åº—åªè³£å…©ç¨®å•†å“"></a>å ´æ™¯ï¼šæœ‰å…©é–“åº—ï¼Œ3 ç¨®å•†å“ï¼Œå…¶ä¸­ä¸€é–“åº—åªè³£å…©ç¨®å•†å“</h3><aside>ğŸš§ å»ºç«‹å•†åº—<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-comment"># store</span><br>s1 = <span class="hljs-title class_">Store</span>.create(<span class="hljs-symbol">title:</span> <span class="hljs-string">&quot;7-11&quot;</span>)<br>s2 = <span class="hljs-title class_">Store</span>.create(<span class="hljs-symbol">title:</span> <span class="hljs-string">&quot;OK-store&quot;</span>)<br></code></pre></td></tr></table></figure><p>å»ºç«‹å•†å“</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-comment"># product</span><br>p1 = <span class="hljs-title class_">Product</span>.create(<span class="hljs-symbol">name:</span> <span class="hljs-string">&#x27;ç´…èŒ¶&#x27;</span>, <span class="hljs-symbol">price:</span> <span class="hljs-number">10</span>)<br>p2 = <span class="hljs-title class_">Product</span>.create(<span class="hljs-symbol">name:</span> <span class="hljs-string">&#x27;ç¶ èŒ¶&#x27;</span>, <span class="hljs-symbol">price:</span> <span class="hljs-number">15</span>)<br>p3 = <span class="hljs-title class_">Product</span>.create(<span class="hljs-symbol">name:</span> <span class="hljs-string">&#x27;å¥¶èŒ¶&#x27;</span>, <span class="hljs-symbol">price:</span> <span class="hljs-number">20</span>)<br></code></pre></td></tr></table></figure><p>å°‡å•†å“åŠ å…¥åˆ°å•†åº—</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ruby">s1.products = [p1, p2]<br>s2.products = [p1, p2, p3]<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ç•¶å•†å“è¢«åŠ å…¥åˆ°å•†åº—æ™‚æ˜¯é€é <strong>ware_houses</strong> é€™å¼µ Table åŠ å…¥åˆ°å°æ‡‰çš„ _id æ¬„ä½ã€‚</p><p><img src="/img/%E8%B3%87%E6%96%99%E8%A1%A8%E9%97%9C%E8%81%AF/Untitled%2012.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p><p>ä»¥å•†åº—çš„è§’åº¦ä¾†çœ‹ï¼Œé€šé &#96;.**all æŸ¥è©¢çµæœæ˜¯é€é **ware_houses** é€™å¼µ Table å°‡å°æ‡‰çš„è³‡æ–™æ‰¾å‡ºä¾†ã€‚</p><p><img src="/img/%E8%B3%87%E6%96%99%E8%A1%A8%E9%97%9C%E8%81%AF/Untitled%2013.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p><p>ä»¥å•†å“çš„è§’åº¦ä¾†çœ‹ï¼Œé€šé <code>.stores</code> ****æŸ¥è©¢å•†åº—ï¼Œå®ƒæœƒé€é **ware_houses** é€™å¼µ Table å°‡å°æ‡‰çš„è³‡æ–™æ‰¾å‡ºä¾†ã€‚</p><p><img src="/img/%E8%B3%87%E6%96%99%E8%A1%A8%E9%97%9C%E8%81%AF/Untitled%2014.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p></aside><h3 id="ç¸½çµï¼šç•¶å…©å€‹-Model-é€éç¬¬ä¸‰å€‹-Model-ä½œç‚ºé—œè¯æ™‚ï¼Œå®ƒå€‘å¯ä»¥ç›¸äº’æŸ¥è©¢å°æ–¹çš„è³‡æ–™ï¼Œè€Œç¬¬ä¸‰å€‹-Model-ç›¸ç•¶æ–¼æºé€šçš„æ©‹æ¨‘ã€‚"><a href="#ç¸½çµï¼šç•¶å…©å€‹-Model-é€éç¬¬ä¸‰å€‹-Model-ä½œç‚ºé—œè¯æ™‚ï¼Œå®ƒå€‘å¯ä»¥ç›¸äº’æŸ¥è©¢å°æ–¹çš„è³‡æ–™ï¼Œè€Œç¬¬ä¸‰å€‹-Model-ç›¸ç•¶æ–¼æºé€šçš„æ©‹æ¨‘ã€‚" class="headerlink" title="ç¸½çµï¼šç•¶å…©å€‹ Model é€éç¬¬ä¸‰å€‹ Model ä½œç‚ºé—œè¯æ™‚ï¼Œå®ƒå€‘å¯ä»¥ç›¸äº’æŸ¥è©¢å°æ–¹çš„è³‡æ–™ï¼Œè€Œç¬¬ä¸‰å€‹ Model ç›¸ç•¶æ–¼æºé€šçš„æ©‹æ¨‘ã€‚"></a>ç¸½çµï¼šç•¶å…©å€‹ Model é€éç¬¬ä¸‰å€‹ Model ä½œç‚ºé—œè¯æ™‚ï¼Œå®ƒå€‘å¯ä»¥ç›¸äº’æŸ¥è©¢å°æ–¹çš„è³‡æ–™ï¼Œè€Œç¬¬ä¸‰å€‹ Model ç›¸ç•¶æ–¼æºé€šçš„æ©‹æ¨‘ã€‚</h3>]]></content>
    
    
    <categories>
      
      <category>å­¸ç¿’ç­†è¨˜</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ruby on rails</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CI å¹³å°éƒ¨ç½²</title>
    <link href="/2023/04/02/docker/CI%E5%B9%B3%E5%8F%B0%E9%83%A8%E7%BD%B2/"/>
    <url>/2023/04/02/docker/CI%E5%B9%B3%E5%8F%B0%E9%83%A8%E7%BD%B2/</url>
    
    <content type="html"><![CDATA[<hr><span id="more"></span><p>æ¶æ§‹åœ–:</p><p><img src="/img/docker/CI%E5%B9%B3%E5%8F%B0%E9%83%A8%E7%BD%B2/CICD.jpg" srcset="/img/loading.gif" lazyload alt="CICD.jpg"></p><ol><li>é–‹ç™¼äººå“¡å°‡code æäº¤åˆ°gitåº«</li><li>ç”±Jenkinsæ‹‰å–gitåº«çš„codeé€²è¡Œç·¨è­¯,ç·¨è­¯æˆåŠŸå¾Œ,æœƒæ‰“åŒ…ä¸€å€‹æ–°çš„å¢ƒåƒæ¨é€åˆ° harbor</li><li>æœ€å¾Œéƒ¨ç½²åœ¨productç’°å¢ƒ</li></ol><h2 id="1-å®‰è£Gitlab"><a href="#1-å®‰è£Gitlab" class="headerlink" title="1.å®‰è£Gitlab"></a>1.å®‰è£Gitlab</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -d \<br>--name gitlab \<br>-p 8443:443 \<br>-p 9999:80 \<br>-p 9998:22 \<br>-v <span class="hljs-variable">$PWD</span>/config:/etc/gitlab \<br>-v <span class="hljs-variable">$PWD</span>/logs:/var/log/gitlab \<br>-v <span class="hljs-variable">$PWD</span>/data:/var/opt/gitlab \<br>-v /etc/localtime:/etc/localtime \<br>--restart=always \<br>lizhenliang/gitlab-ce-zh:latest<br></code></pre></td></tr></table></figure><h2 id="2-å®‰è£harbor"><a href="#2-å®‰è£harbor" class="headerlink" title="2.å®‰è£harbor"></a>2.å®‰è£harbor</h2><h2 id="3-éƒ¨ç½²jenkins"><a href="#3-éƒ¨ç½²jenkins" class="headerlink" title="3.éƒ¨ç½²jenkins"></a>3.éƒ¨ç½²jenkins</h2><ul><li><p>æº–å‚™JDKå’ŒMavenç’°å¢ƒ</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">tar zxvf jdk-8u45-linux-x64.tar.gz<br><span class="hljs-built_in">mv</span> jdk1.8.0_45 /usr/local/jdk<br>tar zxf apache-maven-3.5.0-bin.tar.gz<br><span class="hljs-built_in">mv</span> apache-maven-3.5.0 /usr/local/maven<br></code></pre></td></tr></table></figure><p>  å•Ÿå‹•jenkins ,æ›è¼‰ jdk,maven ä¾è³´æº</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -d --name jenkins -p 80:8080 -p 50000:50000 -u root  \<br>   -v /opt/jenkins_home:/var/jenkins_home \<br>   -v /var/run/docker.sock:/var/run/docker.sock   \<br>   -v /usr/bin/docker:/usr/bin/docker \<br>   -v /usr/local/maven:/usr/local/maven \<br>   -v /usr/local/jdk:/usr/local/jdk \<br>   -v /etc/localtime:/etc/localtime \<br>   --restart=always \<br>   --name jenkins jenkins/jenkins<br></code></pre></td></tr></table></figure><p>  å®‰è£æ’ä»¶</p><p>  ç®¡ç†Jenkinsâ†’ç³»ç»Ÿé…ç½®â†’ç®¡ç†æ’ä»¶â†’æœç´¢git&#x2F;<strong>pipeline</strong>ï¼Œé»é¸å¾Œ<strong>å®‰è£</strong></p>  <figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs groovy"><span class="hljs-meta">#!/usr/bin/env groovy</span><br><br><span class="hljs-keyword">def</span> registry = <span class="hljs-string">&quot;**reg.ahern.com**&quot;</span><br># å°ˆæ¡ˆå<br><span class="hljs-keyword">def</span> project = <span class="hljs-string">&quot;welcome&quot;</span><br><span class="hljs-keyword">def</span> app_name = <span class="hljs-string">&quot;demo&quot;</span><br># é¡åƒåœ°å€/å°ˆæ¡ˆå<br><span class="hljs-keyword">def</span> image_name = <span class="hljs-string">&quot;$&#123;registry&#125;/$&#123;project&#125;/$&#123;app_name&#125;:$&#123;**Branch**&#125;-$&#123;BUILD_NUMBER&#125;&quot;</span><br><span class="hljs-keyword">def</span> git_address = <span class="hljs-string">&quot;**http://192.168.238.131:9999/root/java-demo**&quot;</span><br>#é€éæ·»åŠ jenkinsçš„èªè­‰è¨Šæ¯ç”Ÿæˆçš„æ†‘è­‰<br><span class="hljs-keyword">def</span> docker_registry_auth = <span class="hljs-string">&quot;**fdbd165a-699a-4350-af5c-78494281db15**&quot;</span><br><span class="hljs-keyword">def</span> git_auth = <span class="hljs-string">&quot;**316713bd-bbc5-47a7-8168-c3d99eddeb4c**&quot;</span><br><br>pipeline &#123;<br>    agent any<br>    stages &#123;<br>        stage(<span class="hljs-string">&#x27;æ‹‰å–ä»£ç &#x27;</span>)&#123;<br>            steps &#123;<br>              checkout([<span class="hljs-attr">$class:</span> <span class="hljs-string">&#x27;GitSCM&#x27;</span>, <span class="hljs-attr">branches:</span> [[<span class="hljs-attr">name:</span> <span class="hljs-string">&#x27;$&#123;Branch&#125;&#x27;</span>]], <span class="hljs-attr">userRemoteConfigs:</span> [[<span class="hljs-attr">credentialsId:</span> <span class="hljs-string">&quot;$&#123;git_auth&#125;&quot;</span>, <span class="hljs-attr">url:</span> <span class="hljs-string">&quot;$&#123;git_address&#125;&quot;</span>]]])<br>            &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;ä»£ç ç¼–è¯‘&#x27;</span>)&#123;<br>           steps &#123;<br>             sh <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">                JAVA_HOME=/usr/local/jdk</span><br><span class="hljs-string">                PATH=$JAVA_HOME/bin:/usr/local/maven/bin:$PATH</span><br><span class="hljs-string">                mvn clean package -Dmaven.test.skip=true</span><br><span class="hljs-string">                &quot;&quot;&quot;</span> <br>           &#125;<br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;æ„å»ºé•œåƒ&#x27;</span>)&#123;<br>           steps &#123;<br>                withCredentials([usernamePassword(<span class="hljs-attr">credentialsId:</span> <span class="hljs-string">&quot;$&#123;docker_registry_auth&#125;&quot;</span>, <span class="hljs-attr">passwordVariable:</span> <span class="hljs-string">&#x27;password&#x27;</span>, <span class="hljs-attr">usernameVariable:</span> <span class="hljs-string">&#x27;username&#x27;</span>)]) &#123;<br>                sh <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">                  echo &#x27;</span><br><span class="hljs-string">                    FROM $&#123;registry&#125;/library/tomcat:v1</span><br><span class="hljs-string">                    LABEL maitainer lizhenliang</span><br><span class="hljs-string">                    RUN rm -rf /usr/local/tomcat/webapps/*</span><br><span class="hljs-string">                    ADD target/*.war /usr/local/tomcat/webapps/ROOT.war</span><br><span class="hljs-string">                  &#x27; &gt; Dockerfile</span><br><span class="hljs-string">                  docker build -t $&#123;image_name&#125; .</span><br><span class="hljs-string">                  docker login -u $&#123;username&#125; -p &#x27;$&#123;password&#125;&#x27; $&#123;registry&#125;</span><br><span class="hljs-string">                  docker push $&#123;image_name&#125;</span><br><span class="hljs-string">                &quot;&quot;&quot;</span><br>                &#125;<br>           &#125; <br>        &#125;<br><br>        stage(<span class="hljs-string">&#x27;éƒ¨ç½²åˆ°Docker&#x27;</span>)&#123;<br>           steps &#123;<br>              sh <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">              docker rm -f tomcat-java-demo |true</span><br><span class="hljs-string">              docker container run -d --name tomcat-java-demo -p 88:8080 $&#123;image_name&#125;</span><br><span class="hljs-string">              &quot;&quot;&quot;</span><br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>  å°‡harborçš„æ†‘è­‰è¨Šæ¯äº¤ç”±jenkins</p><p>  Jenkins â†’ ç®¡ç†Jenkins â†’ <strong><a href="http://192.168.238.131/credentials">Manage Credentials</a> â†’ global â†’ æ·»åŠ harbor ç™»å…¥è¨Šæ¯</strong></p><p>  <img src="/img/docker/CI%E5%B9%B3%E5%8F%B0%E9%83%A8%E7%BD%B2/Untitled.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p><p>  æ·»åŠ å®Œå¾Œç”Ÿæˆæ†‘è­‰(ID)</p><p>  <img src="/img/docker/CI%E5%B9%B3%E5%8F%B0%E9%83%A8%E7%BD%B2/Untitled%201.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p>  <aside>  â€¼ï¸ é€é **Pipeline Syntax** ç”Ÿæˆç›¸å°æ‡‰èªæ³•    </aside></li></ul>]]></content>
    
    
    <categories>
      
      <category>å­¸ç¿’ç­†è¨˜</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Harbor</title>
    <link href="/2023/04/02/docker/harbor/"/>
    <url>/2023/04/02/docker/harbor/</url>
    
    <content type="html"><![CDATA[<hr><span id="more"></span><h1 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°:"></a>æ¦‚è¿°:</h1><p>æ˜¯ç”±VMWareé–‹æºçš„å®¹å™¨é¡åƒå€‰åº«,åŸºæ–¼<strong>Docker registry</strong>åšçš„æ“´å±•ã€‚</p><p>é…ç½®éœ€æ±‚:</p><ul><li>CPU 2æ ¸&#x2F;è¨˜æ†¶é«”4G&#x2F;ç¡¬ç¢Ÿç©ºé–“40GB</li><li>å»ºè­°é…ç½®: 4æ ¸&#x2F;è¨˜æ†¶é«”8G&#x2F;ç¡¬ç¢Ÿç©ºé–“160GB</li><li>Docker CE 17.06 ä»¥ä¸Š</li><li>Docker Compose 1.18 ä»¥ä¸Š</li></ul><p>å®‰è£æ–¹å¼:</p><blockquote><p>Docker Hubä¸‹è¼‰Harborç›¸é—œé¡åƒã€‚</p></blockquote><blockquote><p>å®‰è£åŒ…,åŒ…å«ç›¸é—œéƒ¨ç½²é¡åƒ,ä½”ç”¨ç©ºé–“è¼ƒå¤§ã€‚</p></blockquote><hr><h1 id="éƒ¨ç½²HTTP"><a href="#éƒ¨ç½²HTTP" class="headerlink" title="éƒ¨ç½²HTTP"></a>éƒ¨ç½²HTTP</h1><h2 id="1ã€å®‰è£Dockerå’ŒDocker-Compose"><a href="#1ã€å®‰è£Dockerå’ŒDocker-Compose" class="headerlink" title="1ã€å®‰è£Dockerå’ŒDocker Compose"></a>1ã€å®‰è£Dockerå’ŒDocker Compose</h2><h3 id="ä¸‹è¼‰docker-composeä¸¦å®‰è£"><a href="#ä¸‹è¼‰docker-composeä¸¦å®‰è£" class="headerlink" title="ä¸‹è¼‰docker-composeä¸¦å®‰è£"></a>ä¸‹è¼‰docker-composeä¸¦å®‰è£</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># docker-compose</span><br>wget https://github.com/docker/compose/releases/download/v2.0.1/docker-compose-linux-x86_64<br><span class="hljs-built_in">mv</span> docker-compose-linux-x86_64 /usr/bin/docker-compose<br><span class="hljs-built_in">chmod</span> +x /usr/bin/docker-compose<br></code></pre></td></tr></table></figure><hr><h2 id="2ã€ä¸‹è¼‰harborå®‰è£ã€å•Ÿç”¨"><a href="#2ã€ä¸‹è¼‰harborå®‰è£ã€å•Ÿç”¨" class="headerlink" title="2ã€ä¸‹è¼‰harborå®‰è£ã€å•Ÿç”¨"></a>2ã€ä¸‹è¼‰harborå®‰è£ã€å•Ÿç”¨</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># harbor</span><br>wget https://github.com/goharbor/harbor/releases/download/v2.2.2-rc1/harbor-offline-installer-v2.2.2-rc1.tgz<br>tar zxvf harbor-offline-installer-v2.2.2-rc1.tgz<br><br><span class="hljs-comment"># ä¿®æ”¹ harbor.ymlæ–‡ä»¶</span><br>hostname: **reg.ahern.com**  <span class="hljs-comment"># è¨ªå•åŸŸå</span><br>Harbor12345<br><br><span class="hljs-comment"># åŸ·è¡Œæº–å‚™è…³æœ¬</span><br>./prepare<br><span class="hljs-comment"># åŸ·è¡Œå®‰è£è…³æœ¬</span><br>./instal.sh<br><br><span class="hljs-comment"># ç¶å®šhost</span><br>vi /etc/hosts<br>ä¸»æ©ŸIP **reg.ahern.com**<br><br></code></pre></td></tr></table></figure><p><img src="/img/docker/harbor/Untitled.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p><h3 id="ç™»å…¥harbor"><a href="#ç™»å…¥harbor" class="headerlink" title="ç™»å…¥harbor"></a>ç™»å…¥harbor</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#é…ç½®é¡åƒå€‰åº«å¯ä¿¡ä»»</span><br>vi /etc/docker/daemon.json<br>&#123;<span class="hljs-string">&quot;insecure-registries&quot;</span>:[<span class="hljs-string">&quot;reg.ctnrs.com&quot;</span>]&#125;<br><br><span class="hljs-comment"># é‡å•Ÿ</span><br>systemctl restart docker<br>docker-compose up -d<br><br><span class="hljs-comment"># ç™»å…¥</span><br>docker login **reg.ahern.com**<br></code></pre></td></tr></table></figure><aside>âš ï¸ ç™»å…¥æˆåŠŸ</aside><p><img src="/img/docker/harbor/Untitled%201.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p><h3 id="æ¨é€é¡åƒ"><a href="#æ¨é€é¡åƒ" class="headerlink" title="æ¨é€é¡åƒ"></a>æ¨é€é¡åƒ</h3><p>é»é¸ <strong>é …ç›®å</strong> â†’ <strong>æ¨é€é¡åƒçš„Dockerå‘½ä»¤ å¯æŸ¥çœ‹æ¨é€å‘½ä»¤</strong></p><p><img src="/img/docker/harbor/Untitled%202.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p><p><img src="/img/docker/harbor/Untitled%203.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p><h1 id="éƒ¨ç½²HTTPS"><a href="#éƒ¨ç½²HTTPS" class="headerlink" title="éƒ¨ç½²HTTPS"></a>éƒ¨ç½²HTTPS</h1><ol><li><p>ç”ŸæˆSSLè­‰æ›¸</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ç²å–cfsslæ–‡ä»¶</span><br>wget https://pkg.cfssl.org/R1.2/cfssl_linux-amd64<br>wget https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64<br>wget https://pkg.cfssl.org/R1.2/cfssl-certinfo_linux-amd64<br><span class="hljs-built_in">chmod</span> +x cfssl*<br><span class="hljs-built_in">mv</span> cfssl_linux-amd64 /usr/bin/cfssl<br><span class="hljs-built_in">mv</span> cfssljson_linux-amd64 /usr/bin/cfssljson<br><span class="hljs-built_in">mv</span> cfssl-certinfo_linux-amd64 /usr/bin/cfssl-certinfo<br></code></pre></td></tr></table></figure> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ç”Ÿæˆcaè¨­å®šæ–‡ä»¶</span><br><span class="hljs-built_in">cat</span> &gt; ca-config.json &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">&#123;</span><br><span class="hljs-string">  &quot;signing&quot;: &#123;</span><br><span class="hljs-string">    &quot;default&quot;: &#123;</span><br><span class="hljs-string">      &quot;expiry&quot;: &quot;87600h&quot;</span><br><span class="hljs-string">    &#125;,</span><br><span class="hljs-string">    &quot;profiles&quot;: &#123;</span><br><span class="hljs-string">      &quot;kubernetes&quot;: &#123;</span><br><span class="hljs-string">         &quot;expiry&quot;: &quot;87600h&quot;,</span><br><span class="hljs-string">         &quot;usages&quot;: [</span><br><span class="hljs-string">            &quot;signing&quot;,</span><br><span class="hljs-string">            &quot;key encipherment&quot;,</span><br><span class="hljs-string">            &quot;server auth&quot;,</span><br><span class="hljs-string">            &quot;client auth&quot;</span><br><span class="hljs-string">        ]</span><br><span class="hljs-string">      &#125;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">  &#125;</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">EOF</span><br><br><span class="hljs-built_in">cat</span> &gt; ca-csr.json &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">&#123;</span><br><span class="hljs-string">    &quot;CN&quot;: &quot;kubernetes&quot;,</span><br><span class="hljs-string">    &quot;key&quot;: &#123;</span><br><span class="hljs-string">        &quot;algo&quot;: &quot;rsa&quot;,</span><br><span class="hljs-string">        &quot;size&quot;: 2048</span><br><span class="hljs-string">    &#125;,</span><br><span class="hljs-string">    &quot;names&quot;: [</span><br><span class="hljs-string">        &#123;</span><br><span class="hljs-string">            &quot;C&quot;: &quot;CN&quot;,</span><br><span class="hljs-string">            &quot;L&quot;: &quot;Beijing&quot;,</span><br><span class="hljs-string">            &quot;ST&quot;: &quot;Beijing&quot;</span><br><span class="hljs-string">        &#125;</span><br><span class="hljs-string">    ]</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">EOF</span><br><span class="hljs-comment"># ç”Ÿæˆæ–‡ä»¶</span><br>cfssl gencert -initca ca-csr.json | cfssljson -bare ca -<br><br><span class="hljs-built_in">cat</span> &gt; reg.ctnrs.com-csr.json &lt;&lt;<span class="hljs-string">EOF</span><br><span class="hljs-string">&#123;</span><br><span class="hljs-string">  &quot;CN&quot;: &quot;**reg.ahern.com**&quot;,</span><br><span class="hljs-string">  &quot;hosts&quot;: [],</span><br><span class="hljs-string">  &quot;key&quot;: &#123;</span><br><span class="hljs-string">    &quot;algo&quot;: &quot;rsa&quot;,</span><br><span class="hljs-string">    &quot;size&quot;: 2048</span><br><span class="hljs-string">  &#125;,</span><br><span class="hljs-string">  &quot;names&quot;: [</span><br><span class="hljs-string">    &#123;</span><br><span class="hljs-string">      &quot;C&quot;: &quot;CN&quot;,</span><br><span class="hljs-string">      &quot;L&quot;: &quot;BeiJing&quot;,</span><br><span class="hljs-string">      &quot;ST&quot;: &quot;BeiJing&quot;</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">  ]</span><br><span class="hljs-string">&#125;</span><br><span class="hljs-string">EOF</span><br><span class="hljs-comment"># ç”Ÿæˆè­‰æ›¸</span><br>cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes reg.ctnrs.com-csr.json | cfssljson -bare reg.ctnrs.com<br></code></pre></td></tr></table></figure></li><li><p>Harborå•Ÿç”¨HTTPS</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">vi harbor.yml<br><br><span class="hljs-comment">#ä¿®æ”¹ä»¥ä¸‹é…ç½®</span><br>https:<br>port: 443<br>certificate: /root/harbor/ssl/**reg.ahern.com.pem**<br>private_key: /root/harbor/ssl/**reg.ahern.com-key.pem**<br></code></pre></td></tr></table></figure></li><li><p>é‡æ–°é…ç½®ã€éƒ¨ç½²Harbor</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#æ›´æ–°é…ç½®</span><br>./prepare<br><br>docker-compose down<br>docker-compose up â€“d<br></code></pre></td></tr></table></figure><p> <img src="/img/docker/harbor/Untitled%204.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p> <aside> âš ï¸ æŸ¥çœ‹æ†‘è­‰æ˜¯æˆ‘å€‘ç”Ÿæˆçš„è­‰æ›¸ <p> <img src="/img/docker/harbor/Untitled%205.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p> </aside></li></ol><h3 id="å®¢æˆ¶ç«¯è¨ªå•é…ç½®"><a href="#å®¢æˆ¶ç«¯è¨ªå•é…ç½®" class="headerlink" title="å®¢æˆ¶ç«¯è¨ªå•é…ç½®"></a>å®¢æˆ¶ç«¯è¨ªå•é…ç½®</h3><p>å¾å…¶ä»–ä¸»æ©Ÿ docker loginç™»å…¥è‡³æœå‹™ç«¯çš„harbor</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#ç¶å®šæœå‹™ç«¯çš„hosts</span><br>vi /etc/hosts<br><br></code></pre></td></tr></table></figure><aside>â€¼ï¸ ç”±äºharboræœªé…ç½®httpsï¼Œéœ€è¦åœ¨dockeré…ç½®å¯ä¿¡ä»»ã€‚</aside><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># cat /etc/docker/daemon.json </span><br>&#123;<span class="hljs-string">&quot;registry-mirrors&quot;</span>: [<span class="hljs-string">&quot;**https://b9pmyelo.mirror.aliyuncs.com**&quot;</span>],<br>  <span class="hljs-string">&quot;insecure-registries&quot;</span>: [<span class="hljs-string">&quot;**192.168.31.130**&quot;</span>]<br>&#125;<br><span class="hljs-comment"># systemctl restart docker</span><br></code></pre></td></tr></table></figure><aside>âš ï¸ è­‰æ›¸ç°½åå•é¡Œ</aside><p><img src="/img/docker/harbor/Untitled%206.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p><p>å°‡è­‰æ›¸è¤‡è£½åˆ°å®¢æˆ¶ç«¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">scp **reg.ahern.com.pem root@192.168.238.131**:~<br><br><span class="hljs-comment">#å‰µå»ºè­‰æ›¸ç›®éŒ„(dockeré è¨­)</span><br><span class="hljs-built_in">mkdir</span> /etc/docker/certs.d/**reg.ahern.com**<br><br><span class="hljs-comment">#å°‡è­‰æ›¸æ”¾åˆ°è©²ç›®éŒ„ä¸‹ä¸¦æ”¹æˆ crtå¾Œç¶´</span><br><span class="hljs-built_in">cp</span> **reg.ahern.com.** /etc/docker/certs.d/**reg.ahern.com.crt**<br></code></pre></td></tr></table></figure><p>è¤‡è£½æ‹‰å–é¡åƒå‘½ä»¤</p><p><img src="/img/docker/harbor/Untitled%207.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p><aside>âš ï¸ å®¢æˆ¶ç«¯æˆåŠŸæ‹‰å–åˆ°é¡åƒ</aside><p><img src="/img/docker/harbor/Untitled%208.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p><p><img src="/img/docker/harbor/Untitled%209.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p><hr><h1 id="ä¸»å¾è¤‡è£½"><a href="#ä¸»å¾è¤‡è£½" class="headerlink" title="ä¸»å¾è¤‡è£½"></a>ä¸»å¾è¤‡è£½</h1><p>ç›®çš„æ˜¯è§£æ±ºé«˜å¯ç”¨å•é¡Œ</p><ul><li><p><strong>ä¸»å‚™</strong></p><p>  ç°¡æ˜“,ä¸»æ›äº†ä¹‹å¾Œæœƒåˆ‡æœƒå‚™ç”¨Harbor</p><p>  åŒæ™‚åªæä¾›ä¸€å°æœå‹™</p><p>  é©åˆå°‘é‡é¡åƒå‚³è¼¸</p></li></ul><p><img src="/img/docker/harbor/Untitled%2010.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p><ul><li><p>é›™ä¸»è¤‡è£½</p><p>  é›™å‘é…ç½®è¤‡è£½</p><p>  åŒæ™‚å…©å°æœå‹™é‹è¡Œ</p><p>  éœ€è¦è² è¼‰å‡è¡¡</p></li></ul><p><img src="/img/docker/harbor/Untitled%2011.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p><ul><li><p>ä¸€ä¸»å¤šå¾</p><p>  å¤šå€‹å¾åŒæ­¥ä¸»é…ç½®</p><p>  é©åˆå¤šå€åŸŸæ¥­å‹™(è·¨æ©Ÿæˆ¿),å¤§é‡é¡åƒå‚³è¼¸éœ€æ±‚</p></li></ul><p><img src="/img/docker/harbor/Untitled%2012.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p><h1 id="ä¸»å‚™ç’°å¢ƒæ­å»º"><a href="#ä¸»å‚™ç’°å¢ƒæ­å»º" class="headerlink" title="ä¸»å‚™ç’°å¢ƒæ­å»º"></a>ä¸»å‚™ç’°å¢ƒæ­å»º</h1><ul><li>å…©å°è™›æ“¬æ©Ÿ: 1 å°ä¸»æœå‹™ ã€1 å°å®¢æˆ¶ç«¯</li><li>harbor</li><li>docker-compose</li></ul><h2 id="ä¸»ç¯€é»"><a href="#ä¸»ç¯€é»" class="headerlink" title="ä¸»ç¯€é»"></a>ä¸»ç¯€é»</h2><p>å€‰åº«ç®¡ç† â†’ æ–°å»ºç›®æ¨™ â†’ å¡«é¸ç›®æ¨™æ©Ÿè¨Šæ¯</p><p><img src="/img/docker/harbor/Untitled%2013.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p><aside>âš ï¸ é€£æ¥æˆåŠŸ</aside><p><img src="/img/docker/harbor/Untitled%2014.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p><p>è¤‡è£½ç®¡ç† â†’ æ–°å»ºè¦å‰‡ â†’ å¡«é¸ç›®æ¨™æ©Ÿè¨Šæ¯</p><p><img src="/img/docker/harbor/Untitled%2015.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p><aside>âš ï¸ å‰µå»ºæˆåŠŸ</aside><p><img src="/img/docker/harbor/Untitled%2016.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p><h2 id="å‚™ç”¨ç¯€é»-â€”-æ¸¬è©¦é¡åƒç®¡ç†åŒæ­¥"><a href="#å‚™ç”¨ç¯€é»-â€”-æ¸¬è©¦é¡åƒç®¡ç†åŒæ­¥" class="headerlink" title="å‚™ç”¨ç¯€é» â€” æ¸¬è©¦é¡åƒç®¡ç†åŒæ­¥"></a>å‚™ç”¨ç¯€é» â€” æ¸¬è©¦é¡åƒç®¡ç†åŒæ­¥</h2><ol><li><p>é¡åƒæ‰“ä¸Šæ¨™ç±¤</p> <figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs docker">docker tag **centos reg.ahern.com/library/centos**<br></code></pre></td></tr></table></figure></li><li><p>æ¨é€é¡åƒ</p> <figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs docker">docker push<br></code></pre></td></tr></table></figure> <aside> âš ï¸ æ¨é€æˆåŠŸ  </aside> <p> <img src="/img/docker/harbor/Untitled%2017.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p></li><li><p>æŸ¥çœ‹ä¸»ç¯€é» Harbo é …ç›® â†’ é¡åƒå€‰åº«,å·²æˆåŠŸåŒæ­¥</p><p> <img src="/img/docker/harbor/Untitled%2018.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p></li></ol><p>harborçš„å®¹å™¨çµ„ä»¶</p><p><img src="/img/docker/harbor/Untitled%2019.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p><p><a href="https://www.notion.so/065fab38f6494f6bbfcbd9b70e0c1feb">harborå®¹å™¨ç¾¤é›†</a></p><p><img src="/img/docker/harbor/Untitled%2020.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p><p>å®¹å™¨æ•¸æ“šæŒä¹…åŒ–ç›®éŒ„ï¼š&#x2F;data<br>æ—¥èªŒæ–‡ä»¶ç›®éŒ„ï¼š&#x2F;var&#x2F;log&#x2F;harbor</p><hr><p><a href="https://www.notion.so/Prometheus-Grafana-Docker-56a5aa6ab0854dbdb518af309cf03ea5">ç›£æ§ç³»çµ±éƒ¨ç½²(Prometheus+Grafanaç›£æ§Dockerä¸»æ©Ÿ)</a></p><p><a href="https://www.notion.so/CI-aec2bf6766834052aae15d8351713851">CI å¹³å° å®¹å™¨åŒ–éƒ¨ç½²</a></p>]]></content>
    
    
    <categories>
      
      <category>å­¸ç¿’ç­†è¨˜</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç›£æ§ç³»çµ±éƒ¨ç½²(Prometheus+Grafanaç›£æ§Dockerä¸»æ©Ÿ)</title>
    <link href="/2023/04/02/docker/%E7%9B%A3%E6%8E%A7%E7%B3%BB%E7%B5%B1%E9%83%A8%E7%BD%B2/"/>
    <url>/2023/04/02/docker/%E7%9B%A3%E6%8E%A7%E7%B3%BB%E7%B5%B1%E9%83%A8%E7%BD%B2/</url>
    
    <content type="html"><![CDATA[<hr><span id="more"></span><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°:"></a>æ¦‚è¿°:</h2><p><strong>cAdvisor</strong> : æ”¶é›†æ­£åœ¨é‹è¡Œçš„å®¹å™¨è³‡æºå’Œæ€§èƒ½ç­‰ã€‚ â€” <a href="https://github.com/google/cadvisor">https://github.com/google/cadvisor</a></p><p><strong>Prometheus</strong> : å®¹å™¨ç›£æ§ç³»çµ±ã€‚â€” <a href="https://prometheus.io/">https://prometheus.io/</a>   , <a href="https://github.com/prometheus">https://github.com/prometheus</a></p><p><strong>Grafana : é–‹æºçš„åº¦é‡åˆ†æå’Œå¯è¦–åŒ–ç³»çµ±ã€‚â€”</strong> <a href="https://grafana.com/grafana">https://grafana.com/grafana</a></p><p><strong>cAdvisor</strong> (æ¡é›†æ‰€æœ‰å®¹å™¨è³‡æºåˆ©ç”¨ç‡,æ‰€æœ‰dockerä¸»æ©Ÿéƒ¨ç½²) â†  <strong>Prometheus(æ”¶é›†å­˜å„²) â† Grafana(å±•ç¤ºæ•¸æ“š)</strong></p><h3 id="cAdvisorï¼š"><a href="#cAdvisorï¼š" class="headerlink" title="cAdvisorï¼š"></a>cAdvisorï¼š</h3><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs docker">docker <span class="hljs-keyword">run</span><span class="language-bash"> -d \</span><br><span class="language-bash">--volume=/:/rootfs:ro \</span><br><span class="language-bash">--volume=/var/run:/var/run:ro \</span><br><span class="language-bash">--volume=/sys:/sys:ro \</span><br><span class="language-bash">--volume=/var/lib/docker/:/var/lib/docker:ro \</span><br><span class="language-bash">--volume=/dev/disk/:/dev/disk:ro \</span><br><span class="language-bash">--publish=8080:8080 \</span><br><span class="language-bash">--detach=<span class="hljs-literal">true</span> \</span><br><span class="language-bash">--name=cadvisor \</span><br><span class="language-bash">google/cadvisor:latest</span><br></code></pre></td></tr></table></figure><h3 id="éƒ¨ç½²Prometheusï¼š"><a href="#éƒ¨ç½²Prometheusï¼š" class="headerlink" title="éƒ¨ç½²Prometheusï¼š"></a>éƒ¨ç½²Prometheusï¼š</h3><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs docker">docker <span class="hljs-keyword">run</span><span class="language-bash"> -d \</span><br><span class="language-bash">--name=prometheus \</span><br><span class="language-bash">-p 9090:9090 \</span><br><span class="language-bash">prom/prometheus</span><br></code></pre></td></tr></table></figure><p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs docker">docker exec -it <span class="hljs-string">&quot;prometheuså®¹å™¨ID&quot;</span> sh<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">vi /etc/prometheus/prometheus.yml<br><br><span class="hljs-comment"># my global config -- æ¡é›†çš„å‘¨æœŸ</span><br>global:<br>  scrape_interval: 15s <span class="hljs-comment"># Set the scrape interval to every 15 seconds. Default is every 1 minute.</span><br>  evaluation_interval: 15s <span class="hljs-comment"># Evaluate rules every 15 seconds. The default is every 1 minute.</span><br>  <span class="hljs-comment"># scrape_timeout is set to the global default (10s).</span><br><br><span class="hljs-comment"># Alertmanager configuration -- æŒ‡å®šå‘Šè­¦çµ„ä»¶</span><br>alerting:<br>  alertmanagers:<br>    - static_configs:<br>        - targets:<br>          <span class="hljs-comment"># - alertmanager:9093</span><br><span class="hljs-comment"># å‘Šè­¦çš„è¦å‰‡</span><br><span class="hljs-comment"># Load rules once and periodically evaluate them according to the global &#x27;evaluation_interval&#x27;.</span><br>rule_files:<br>  <span class="hljs-comment"># - &quot;first_rules.yml&quot;</span><br>  <span class="hljs-comment"># - &quot;second_rules.yml&quot;</span><br><br><span class="hljs-comment"># è¢«æ¡é›†ç«¯(ç›®æ¨™æ©Ÿ)çš„é…ç½®</span><br><span class="hljs-comment"># A scrape configuration containing exactly one endpoint to scrape:</span><br><span class="hljs-comment"># Here it&#x27;s Prometheus itself.</span><br>scrape_configs:<br>  <span class="hljs-comment"># The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config.</span><br>  - job_name: <span class="hljs-string">&quot;prometheus&quot;</span> <span class="hljs-comment">#åˆ†çµ„</span><br><br>    <span class="hljs-comment"># metrics_path defaults to &#x27;/metrics&#x27;</span><br>    <span class="hljs-comment"># scheme defaults to &#x27;http&#x27;.</span><br><br>    static_configs:<br>      - targets: [<span class="hljs-string">&quot;localhost:9090&quot;</span>]   <span class="hljs-comment">#ç›£æ§ç›®æ¨™</span><br></code></pre></td></tr></table></figure><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs docker"><span class="hljs-comment"># é‡å•Ÿ</span><br>docker restart <span class="hljs-string">&quot;prometheuså®¹å™¨ID&quot;</span><br></code></pre></td></tr></table></figure><h3 id="éƒ¨ç½²Grafanaï¼š"><a href="#éƒ¨ç½²Grafanaï¼š" class="headerlink" title="éƒ¨ç½²Grafanaï¼š"></a>éƒ¨ç½²Grafanaï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -d \<br>--name=grafana \<br>-p 3000:3000 \<br>grafana/grafana<br></code></pre></td></tr></table></figure><h3 id="åŠ å…¥æ•¸æ“šæºã€åŠ å…¥prometheusåœ°å€"><a href="#åŠ å…¥æ•¸æ“šæºã€åŠ å…¥prometheusåœ°å€" class="headerlink" title="åŠ å…¥æ•¸æ“šæºã€åŠ å…¥prometheusåœ°å€"></a>åŠ å…¥æ•¸æ“šæºã€åŠ å…¥prometheusåœ°å€</h3><p><img src="/img/docker/%E7%9B%A3%E6%8E%A7%E7%B3%BB%E7%B5%B1%E9%83%A8%E7%BD%B2/Untitled.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p><p><img src="/img/docker/%E7%9B%A3%E6%8E%A7%E7%B3%BB%E7%B5%B1%E9%83%A8%E7%BD%B2/Untitled%201.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p><p><img src="/img/docker/%E7%9B%A3%E6%8E%A7%E7%B3%BB%E7%B5%B1%E9%83%A8%E7%BD%B2/Untitled%202.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p><h3 id="æ–°å¢å„€è¡¨ç›¤"><a href="#æ–°å¢å„€è¡¨ç›¤" class="headerlink" title="æ–°å¢å„€è¡¨ç›¤"></a>æ–°å¢å„€è¡¨ç›¤</h3><p><img src="/img/docker/%E7%9B%A3%E6%8E%A7%E7%B3%BB%E7%B5%B1%E9%83%A8%E7%BD%B2/Untitled%203.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p><h3 id="å»ºç«‹ç¯©é¸æ¢ä»¶"><a href="#å»ºç«‹ç¯©é¸æ¢ä»¶" class="headerlink" title="å»ºç«‹ç¯©é¸æ¢ä»¶"></a>å»ºç«‹ç¯©é¸æ¢ä»¶</h3><aside>âš ï¸ prometheus ä½¿ç”¨ç¨æœ‰çš„èªæ³•åšç¯©é¸, **PromQL**</aside><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">container_memory_usage_bytes&#123;image!=<span class="hljs-string">&quot;&quot;</span>,name=<span class="hljs-string">&quot;cadvisor&quot;</span>&#125;<br></code></pre></td></tr></table></figure><p><img src="/img/docker/%E7%9B%A3%E6%8E%A7%E7%B3%BB%E7%B5%B1%E9%83%A8%E7%BD%B2/Untitled%204.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p><p><img src="/img/docker/%E7%9B%A3%E6%8E%A7%E7%B3%BB%E7%B5%B1%E9%83%A8%E7%BD%B2/Untitled%205.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p><aside>âš ï¸ åœ–è¡¨ç„¡æ•¸æ“šçš„å¯èƒ½åŸå› ï¼š</aside><blockquote><ol><li>æ™‚é–“ä¸åŒæ­¥</li><li>promqlæœ‰å•é¡Œ(ç‰ˆæœ¬ä¸å…¼å®¹)</li><li>prometheusç„¡æ•¸æ“š</li></ol></blockquote>]]></content>
    
    
    <categories>
      
      <category>å­¸ç¿’ç­†è¨˜</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Docker å®¹å™¨ç¶²è·¯</title>
    <link href="/2023/04/02/docker/5-%E5%AE%B9%E5%99%A8%E7%B6%B2%E8%B7%AF/"/>
    <url>/2023/04/02/docker/5-%E5%AE%B9%E5%99%A8%E7%B6%B2%E8%B7%AF/</url>
    
    <content type="html"><![CDATA[<hr><span id="more"></span><h2 id="1-ç¶²è·¯æ¨¡å¼"><a href="#1-ç¶²è·¯æ¨¡å¼" class="headerlink" title="1.ç¶²è·¯æ¨¡å¼"></a>1.ç¶²è·¯æ¨¡å¼</h2><ul><li><p><strong>bridge</strong></p><p>  -net&#x3D;bridge</p><p>  é è¨­æ¨¡å¼,Dockerå•Ÿå‹•å¾Œå‰µå»ºä¸€å€‹ docker0ç¶²å£,æ–°å‰µå»ºçš„å®¹å™¨é è¨­ä¹Ÿæ˜¯æ·»åŠ åœ¨é€™å€‹ç¶²å£ã€‚</p><p>  ä¹Ÿå¯ä»¥è‡ªå®šç¾©ç¶²è·¯,ç›¸æ¯”é è¨­çš„å…§éƒ¨DNSç™¼ç¾,å¯ä»¥é€šéå®¹å™¨åç›¸äº’é€šä¿¡ã€‚</p></li><li><p><strong>host</strong></p><p>  -net&#x3D;host</p><p>  å®¹å™¨åœ¨å‰µå»ºæ™‚ä¸æœƒæœ‰ç¨ç«‹çš„network namespace,è€Œæ˜¯å’Œå®¿ä¸»æ©Ÿå…±ç”¨ã€‚é…ç½®å¾Œ,åªæœ‰ç¶²è·¯å’Œå®¿ä¸»æ©Ÿå…±äº«,å…¶ä»–éƒ½æ˜¯éš”é›¢ã€‚</p></li><li><p><strong>none</strong></p><p>  -net&#x3D;none</p><p>  ç²å–ç¨ç«‹çš„network namespace,ä½†ä¸ç‚ºå®¹å™¨é€²è¡Œç¶²è·¯é…ç½®,éœ€è¦æ‰‹å‹•é…ç½®ã€‚</p></li><li><p><strong>container</strong></p><p>  -net&#x3D;container:Name&#x2F;ID</p><p>  èˆ‡æŒ‡å®šçš„å®¹å™¨å…±ç”¨ä¸€å€‹network namespace,å…·æœ‰ç›¸åŒç¶²è·¯é…ç½®,å…©å€‹å®¹å™¨é™¤ç¶²è·¯å¤–,å…¶ä»–éƒ½æ˜¯éš”é›¢ã€‚</p></li></ul><h2 id="2-Dockerç¶²è·¯æ¨¡å‹"><a href="#2-Dockerç¶²è·¯æ¨¡å‹" class="headerlink" title="2.Dockerç¶²è·¯æ¨¡å‹"></a>2.Dockerç¶²è·¯æ¨¡å‹</h2><p><strong>veth pair</strong>: æˆå°å‡ºç¾çš„è™›æ“¬ç¶²è·¯è¨­å‚™,æ•¸æ“šå¾ä¸€ç«¯é€²,ä¸€ç«¯å‡º,ä¸»è¦ç”¨æ–¼è§£æ±ºç¶²è·¯å‘½åç©ºé–“ä¹‹é–“çš„éš”é›¢ã€‚</p><p><strong>docker0</strong>:bridgeæ˜¯ä¸€å€‹äºŒå±¤ç¶²è·¯è¨­å‚™,é€šébridgeå¯ä»¥å°‡Linuxæ”¯æ´çš„ä¸åŒçš„ç«¯å£é€£æ¥èµ·ä¾†,å¯¦ç¾é¡ä¼¼äº¤æ›æ©Ÿå¤šå°å¤šçš„é€šä¿¡ã€‚</p><p><img src="/img/docker/5-%E5%AE%B9%E5%99%A8%E7%B6%B2%E8%B7%AF/Untitled.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p><h2 id="3-å®¹å™¨ç¶²è·¯è¨ªå•åŸç†"><a href="#3-å®¹å™¨ç¶²è·¯è¨ªå•åŸç†" class="headerlink" title="3.å®¹å™¨ç¶²è·¯è¨ªå•åŸç†"></a>3.å®¹å™¨ç¶²è·¯è¨ªå•åŸç†</h2><p><img src="/img/docker/5-%E5%AE%B9%E5%99%A8%E7%B6%B2%E8%B7%AF/Untitled%201.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p><h2 id="4-å®¹å™¨ç¶²è·¯æ ¸å¿ƒ-iptables"><a href="#4-å®¹å™¨ç¶²è·¯æ ¸å¿ƒ-iptables" class="headerlink" title="4.å®¹å™¨ç¶²è·¯æ ¸å¿ƒ:iptables"></a>4.å®¹å™¨ç¶²è·¯æ ¸å¿ƒ:iptables</h2><p><img src="/img/docker/5-%E5%AE%B9%E5%99%A8%E7%B6%B2%E8%B7%AF/Untitled%202.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p><p><img src="/img/docker/5-%E5%AE%B9%E5%99%A8%E7%B6%B2%E8%B7%AF/Untitled%203.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p><p><strong>INPUTéˆ</strong>ï¼šæ¥æ”¶çš„æ•¸æ“šåŒ…æ˜¯æœ¬æ©Ÿ(å…¥ç«™)æ™‚ï¼Œæ‡‰ç”¨æ­¤éˆä¸­çš„è¦å‰‡ã€‚</p><p><strong>OUTPUTéˆ</strong>ï¼šæœ¬æ©Ÿå‘å¤–ç™¼é€æ•¸æ“šåŒ…(å‡ºç«™)æ™‚ï¼Œæ‡‰ç”¨æ­¤éˆä¸­çš„è¦å‰‡ã€‚</p><p><strong>FORWARDéˆ</strong>ï¼šéœ€è¦é€šéé˜²ç«ç‰†ä¸­è½‰ç™¼é€çµ¦å…¶ä»–åœ°å€çš„æ•¸æ“šåŒ…(è½‰ç™¼)æ™‚ï¼Œæ‡‰ç”¨æ¸¬<br>éˆä¸­çš„è¦å‰‡ã€‚</p><p><strong>PREROUTINGéˆ</strong>ï¼šåœ¨å°æ•¸æ“šåŒ…åšè·¯ç”±é¸æ“‡ä¹‹å‰ï¼Œæ‡‰ç”¨æ­¤éˆä¸­çš„è¦å‰‡ã€‚ </p><p><strong>POSTROUTINGéˆ</strong>ï¼šåœ¨å°æ•¸æ“šåŒ…åšè·¯ç”±é¸æ“‡ä¹‹å¾Œï¼Œæ‡‰ç”¨æ­¤éˆä¸­çš„è¦å‰‡ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#å¤–éƒ¨è¨ªå•å®¹å™¨</span><br>iptables -t nat -vnL DOCKER<br><span class="hljs-comment"># å®¹å™¨è¨ªå•å¤–éƒ¨</span><br>iptables -t nat -vnL POSTROUTING<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># DNAT ç›®çš„åœ°å€è½‰æ›ï¼Œä¿®æ”¹æ•¸æ“šåŒ…ç›®æ¨™IPã€‚</span><br><span class="hljs-comment"># å¤–éƒ¨è¨ªå•å®¹å™¨ï¼š</span><br>-A DOCKER ! -i docker0 -p tcp -m tcp --dport <span class="hljs-string">&#x27;åŸ &#x27;</span> -j DNAT --to-destination <span class="hljs-string">&#x27;å®¹å™¨IP&#x27;</span>:80<br><br><span class="hljs-comment"># MASQUERADE å‹•æ…‹æºåœ°å€è½‰æ›</span><br><span class="hljs-comment"># SNAT ä¿®æ”¹æºIPç‚ºå®¿ä¸»æ©ŸIPå‘å¤–ç™¼å‡º</span><br><span class="hljs-comment"># æ•¸æ“šåŒ…æºIPä¾†è‡ª172.17.0.0/16é€™å€‹ç¶²æ®µéƒ½è¦åšæºåœ°å€è½‰æ›</span><br><br><span class="hljs-comment"># å®¹å™¨è¨ªå•å¤–éƒ¨</span><br>-A POSTROUTING -s 172.17.0.0/16 ! -o docker0 -j MASQUERADE<br></code></pre></td></tr></table></figure><h2 id="5-è·¨ä¸»æ©Ÿç¶²è·¯-dockerä¸»æ©Ÿå®¹å™¨é€šä¿¡"><a href="#5-è·¨ä¸»æ©Ÿç¶²è·¯-dockerä¸»æ©Ÿå®¹å™¨é€šä¿¡" class="headerlink" title="5.è·¨ä¸»æ©Ÿç¶²è·¯: dockerä¸»æ©Ÿå®¹å™¨é€šä¿¡"></a>5.è·¨ä¸»æ©Ÿç¶²è·¯: dockerä¸»æ©Ÿå®¹å™¨é€šä¿¡</h2><h3 id="Flannelæ˜¯CoreOSç¶­è­·çš„ç¶²è·¯çµ„ä»¶-åœ¨ä¸»æ©Ÿä¸Šé‹è¡Œdaemon-process-è² è²¬ç¶­è­·æœ¬åœ°çš„è·¯ç”±è½‰ç™¼-ä½¿ç”¨etcdå„²å­˜ç¶²è·¯èˆ‡å®¹å™¨ä¹‹é–“çš„é—œä¿‚ã€‚"><a href="#Flannelæ˜¯CoreOSç¶­è­·çš„ç¶²è·¯çµ„ä»¶-åœ¨ä¸»æ©Ÿä¸Šé‹è¡Œdaemon-process-è² è²¬ç¶­è­·æœ¬åœ°çš„è·¯ç”±è½‰ç™¼-ä½¿ç”¨etcdå„²å­˜ç¶²è·¯èˆ‡å®¹å™¨ä¹‹é–“çš„é—œä¿‚ã€‚" class="headerlink" title="Flannelæ˜¯CoreOSç¶­è­·çš„ç¶²è·¯çµ„ä»¶,åœ¨ä¸»æ©Ÿä¸Šé‹è¡Œdaemon process,è² è²¬ç¶­è­·æœ¬åœ°çš„è·¯ç”±è½‰ç™¼,ä½¿ç”¨etcdå„²å­˜ç¶²è·¯èˆ‡å®¹å™¨ä¹‹é–“çš„é—œä¿‚ã€‚"></a>Flannelæ˜¯CoreOSç¶­è­·çš„ç¶²è·¯çµ„ä»¶,åœ¨ä¸»æ©Ÿä¸Šé‹è¡Œdaemon process,è² è²¬ç¶­è­·æœ¬åœ°çš„è·¯ç”±è½‰ç™¼,ä½¿ç”¨<strong>etcd</strong>å„²å­˜ç¶²è·¯èˆ‡å®¹å™¨ä¹‹é–“çš„é—œä¿‚ã€‚</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å®‰è£etcd</span><br>yum install etcd -y<br><br><span class="hljs-comment"># é…ç½®</span><br>vi /etc/etcd/etcd.conf<br><br>ETCD_DATA_DIR=<span class="hljs-string">&quot;/var/lib/etcd/default.etcd&quot;</span><br>ETCD_LISTEN_CLIENT_URLS=<span class="hljs-string">&quot;http://&#x27;å®¿ä¸»æ©ŸIP&#x27;:2379&quot;</span><br>ETCD_NAME=<span class="hljs-string">&quot;default&quot;</span><br>ETCD_ADVERTISE_CLIENT_URLS=<span class="hljs-string">&quot;http://&#x27;å®¿ä¸»æ©ŸIP&#x27;:2379&quot;</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å®‰è£flannel</span><br>yum install flannel -y<br><br><span class="hljs-comment"># é…ç½®</span><br>vi /etc/sysconfig/flanneld<br><br>FLANNEL_ETCD_ENDPOINTS=<span class="hljs-string">&quot;http://&#x27;å®¿ä¸»æ©ŸIP&#x27;:2379&quot;</span><br>FLANNEL_ETCD_PREFIX=<span class="hljs-string">&quot;/atomic.io/networkâ€œ</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># etcdæ·»åŠ å­ç¶² set:é…ç½® get:ç²å–</span><br>etcdctl --endpoints=<span class="hljs-string">&quot;http://192.168.31.73:2379&quot;</span> <span class="hljs-built_in">set</span> /atomic.io/network/config <span class="hljs-string">&#x27;&#123; &quot;Network&quot;: </span><br><span class="hljs-string">&quot;172.17.0.0/16&quot;, &quot;Backend&quot;: &#123;&quot;Type&quot;: &quot;vxlan&quot;&#125;&#125; &#x27;</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># é…ç½®Dockerä½¿ç”¨flannelç”Ÿæˆç¶²è·¯è¨Šæ¯</span><br>vi /usr/lib/systemd/system/docker.service<br>EnvironmentFile=/run/flannel/docker<br>ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock<br><br><span class="hljs-comment">#é©—è­‰</span><br><span class="hljs-built_in">echo</span> <span class="hljs-variable">$DOCKER_NETWORK_OPTIONS</span><br><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#å•Ÿå‹•æœå‹™è¨­å®šé–‹æ©Ÿå•Ÿå‹•</span><br>systemctl daemon-reload<br>systemctl start flanneld<br>systemctl <span class="hljs-built_in">enable</span> flanneld<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å­¸ç¿’ç­†è¨˜</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Docker å®¹å™¨ç®¡ç†</title>
    <link href="/2023/04/02/docker/3-%E5%AE%B9%E5%99%A8%E7%AE%A1%E7%90%86/"/>
    <url>/2023/04/02/docker/3-%E5%AE%B9%E5%99%A8%E7%AE%A1%E7%90%86/</url>
    
    <content type="html"><![CDATA[<hr><span id="more"></span><h1 id="å‰µå»ºå®¹å™¨å¸¸ç”¨é¸é …"><a href="#å‰µå»ºå®¹å™¨å¸¸ç”¨é¸é …" class="headerlink" title="å‰µå»ºå®¹å™¨å¸¸ç”¨é¸é …"></a>å‰µå»ºå®¹å™¨å¸¸ç”¨é¸é …</h1><table><thead><tr><th>é¸é …</th><th align="left">èªªæ˜</th><th align="left"></th></tr></thead><tbody><tr><td>i, â€“interactive</td><td align="left">äº¤äº’å¼</td><td align="left"></td></tr><tr><td>-t, â€“tty</td><td align="left">åˆ†é…ä¸€å€‹å½è£ç«¯</td><td align="left"></td></tr><tr><td>-d, â€“detach</td><td align="left">åœ¨å¾Œå°é‹è¡Œ</td><td align="left"></td></tr><tr><td>-e, â€“env</td><td align="left">è¨­å®šç’°å¢ƒè®Šé‡</td><td align="left">å¯è¨­ç½®å¤šå€‹ç’°å¢ƒè®Šé‡(-e)</td></tr><tr><td>-p, â€“publish list</td><td align="left">ç™¼ä½ˆå®¹å™¨ç«¯å£åˆ°ä¸»æ©Ÿ(æš´éœ²ç«¯å£)</td><td align="left">â€œè‡ªå®šç¾©ç«¯å£â€:â€æœå‹™ç«¯å£â€(ex: -p 9999:80)</td></tr><tr><td>-P, -publish-all</td><td align="left">ç™¼ä½ˆå®¹å™¨æ‰€æœ‰EXPOSEçš„ç«¯å£åˆ°å®¿ä¸»æ©Ÿéš¨æ©Ÿç«¯å£</td><td align="left"></td></tr><tr><td>â€“-name string</td><td align="left">æŒ‡å®šå®¹å™¨åç¨±</td><td align="left"></td></tr><tr><td>-h, â€“hostname</td><td align="left">è¨­ç½®å®¹å™¨ä¸»æ©Ÿå</td><td align="left"></td></tr><tr><td>â€“ip,string</td><td align="left">æŒ‡å®šå®¹å™¨IP,å¯ç”¨æ–¼è‡ªå®šç¾©ç¶²è·¯</td><td align="left"></td></tr><tr><td>â€“network</td><td align="left">é€£æ¥å®¹å™¨åˆ°ä¸€å€‹ç¶²è·¯</td><td align="left"></td></tr><tr><td>â€“mount mount</td><td align="left">å°‡æ–‡ä»¶ç³»çµ±é™„åŠ åˆ°å®¹å™¨</td><td align="left"></td></tr><tr><td>-v, â€“volume list</td><td align="left">ç¶å®šæ›è¼‰ä¸€å€‹å·</td><td align="left"></td></tr><tr><td>â€“restart stringload</td><td align="left">å®¹å™¨é€€å‡ºæ™‚é‡å•Ÿç­–ç•¥,é è¨­ç‚ºno,å¯é¸å€¼</td><td align="left"></td></tr></tbody></table><hr><h1 id="è³‡æºé™åˆ¶"><a href="#è³‡æºé™åˆ¶" class="headerlink" title="è³‡æºé™åˆ¶"></a>è³‡æºé™åˆ¶</h1><ul><li>å‰µå»ºçš„å®¹å™¨é è¨­ä½¿ç”¨å®¿ä¸»æ©Ÿæ‰€æœ‰è³‡æº</li></ul><table><thead><tr><th>é¸é …</th><th>æè¿°</th><th></th></tr></thead><tbody><tr><td>-m, -memory</td><td>é™åˆ¶å®¹å™¨è¨˜æ†¶é«”</td><td></td></tr><tr><td>-memory-swap</td><td>å…è¨±äº¤æ›åˆ°ç£ç›¤ç©ºé–“çš„è¨˜æ†¶é«”</td><td></td></tr><tr><td>-memory-swappiness&#x3D;&lt;0-100&gt;</td><td>å®¹å™¨ä½¿ç”¨swapåˆ†å€äº¤æ›çš„ç™¾åˆ†æ¯”</td><td></td></tr><tr><td>-oom-kill-disable</td><td>ç¦ç”¨OOM Killer</td><td>ç•¶æ©Ÿå™¨çš„ç‰©ç†è¨˜æ†¶é«”ä¸è¶³æ™‚,Linuxæœƒæ‰¾å‡ºå ç”¨è³‡æºæœ€å¤§çš„æœå‹™ä¸¦æ®ºæ­»</td></tr><tr><td>pull</td><td>å¾é¡åƒå€‰åº«æ‹‰å–é¡åƒ</td><td></td></tr><tr><td>push</td><td>æ¨é€ä¸€å€‹é¡åƒåˆ°é¡åƒå€‰åº«</td><td></td></tr><tr><td>rm</td><td>åˆªé™¤é¡åƒ</td><td></td></tr><tr><td>prune</td><td>ç§»é™¤æ²’æœ‰è¢«æ¨™è¨˜æˆ–è‘—æ²’æœ‰è¢«å®¹å™¨å¼•ç”¨çš„é¡åƒ</td><td></td></tr><tr><td>tag</td><td>å‰µå»ºä¸€å€‹å¼•ç”¨æºé¡åƒ,æ¨™è¨˜é¡åƒ</td><td></td></tr><tr><td>export</td><td>å°å‡ºå®¹å™¨æ–‡ä»¶ç³»çµ±åˆ°taræ­¸æª”æ–‡ä»¶</td><td></td></tr><tr><td>import</td><td>å°å…¥å®¹å™¨æ–‡ä»¶ç³»çµ±taræ­¸æª”æ–‡ä»¶å‰µå»ºé¡åƒ</td><td></td></tr><tr><td>save</td><td>ä¿å­˜ä¸€å€‹æˆ–å¤šå€‹é¡åƒåˆ°ä¸€å€‹taræ­¸æª”æ–‡ä»¶</td><td></td></tr><tr><td>load</td><td>åŠ è¼‰é¡åƒä¾†è‡ªtaræ­¸æª”æˆ–æ¨™æº–è¼¸å…¥</td><td></td></tr></tbody></table><hr><h1 id="éš”é›¢æ€§-Namespace"><a href="#éš”é›¢æ€§-Namespace" class="headerlink" title="éš”é›¢æ€§(Namespace)"></a>éš”é›¢æ€§(Namespace)</h1><p>åœ¨ç‰©ç†æ©Ÿå™¨ä¸­å¯ä»¥é‹è¡Œå¤šå€‹ä¸åŒçš„æ“ä½œç³»çµ±,é€™å°±éœ€è¦è§£æ±ºéš”é›¢æ€§çš„å•é¡Œ,å°‡ç’°å¢ƒå–®ç¨åˆ†é–‹,ç›¸äº’ä¸å½±éŸ¿ã€‚</p><p>Linux kernelåœ¨2.4.19ç‰ˆæœ¬é–‹å§‹,å¼•ç”¨äº†namespaceæ¦‚å¿µ,ç›®çš„æ˜¯å°‡ç‰¹å®šçš„å…¨å±€è³‡æºé€šéæŠ½è±¡æ–¹æ³•ä½¿namespaceä¸­çš„é€²ç¨‹çœ‹èµ·ä¾†æ“æœ‰è‡ªå·±éš”é›¢çš„è³‡æºã€‚dockerå°±æ˜¯é€éé€™å€‹æ©Ÿåˆ¶å¯¦ç¾å®¹å™¨è³‡æºéš”é›¢ã€‚</p><h2 id="Linuxçš„Namespaceæ©Ÿåˆ¶æä¾›äº†6ç¨®ä¸åŒå‘½åç©ºé–“ï¼š"><a href="#Linuxçš„Namespaceæ©Ÿåˆ¶æä¾›äº†6ç¨®ä¸åŒå‘½åç©ºé–“ï¼š" class="headerlink" title="Linuxçš„Namespaceæ©Ÿåˆ¶æä¾›äº†6ç¨®ä¸åŒå‘½åç©ºé–“ï¼š"></a>Linuxçš„Namespaceæ©Ÿåˆ¶æä¾›äº†6ç¨®ä¸åŒå‘½åç©ºé–“ï¼š</h2><ul><li><strong>IPC</strong>ï¼šéš”é›¢é€²ç¨‹é–“é€šä¿¡</li><li><strong>MOUNT</strong>ï¼šéš”é›¢æ–‡ä»¶ç³»çµ±æ›è¼‰é»</li><li><strong>NET</strong>ï¼šéš”é›¢ç¶²çµ¡å”è­°æ£§</li><li><strong>PID</strong>ï¼šéš”é›¢é€²ç¨‹è™Ÿï¼Œé€²ç¨‹å‘½åç©ºé–“æ˜¯ä¸€å€‹çˆ¶å­çµæ§‹ï¼Œå­ç©ºé–“å°çˆ¶ç©ºé–“å¯è¦‹</li><li><strong>USER</strong>ï¼šéš”é›¢ç”¨æˆ¶</li><li><strong>UTS</strong>ï¼šéš”é›¢ä¸»æ©Ÿåå’ŒåŸŸå</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ll /proc/$$/ns<br></code></pre></td></tr></table></figure><p><img src="/img/docker/3-%E5%AE%B9%E5%99%A8%E7%AE%A1%E7%90%86/Untitled.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p><hr><h1 id="CGroup"><a href="#CGroup" class="headerlink" title="CGroup"></a>CGroup</h1><p>Dockeråˆ©ç”¨namespaceå¯¦ç¾äº†å®¹å™¨é–“çš„è³‡æºéš”é›¢,ä½†æ˜¯ç„¡æ³•å°å®¹å™¨é€²è¡Œè³‡æºé™åˆ¶,å¦‚CPUã€memoryã€‚</p><p>ç•¶ä¸€å€‹å®¹å™¨å±¬æ–¼CPUå¯†é›†æ€§çš„æœå‹™,é€™æ™‚å°±æœƒå ç”¨å¤§é‡çš„CPU,é€²è€Œå°è‡´å…¶ä»–å®¹å™¨ç›¸äº’å½±éŸ¿,æ¶å è³‡æºã€‚</p><p>æ‰€æœ‰çš„ä»»å‹™å°±æ˜¯é‹è¡Œåœ¨ç³»çµ±ä¸­çš„ä¸€å€‹é€²ç¨‹ï¼Œè€Œ <strong>CGroups</strong> ä»¥æŸç¨®æ¨™æº–å°‡ä¸€çµ„é€²ç¨‹ç‚ºç›®æ¨™é€²è¡Œè³‡æºåˆ†é…å’Œæ§åˆ¶ã€‚ä¾‹å¦‚CPUã€memoryã€ç¶²è·¯ç­‰ï¼Œä¸¦ä¸”å¯ä»¥<strong>å‹•æ…‹é…ç½®</strong>ã€‚</p><h3 id="ä¸»è¦åŠŸèƒ½"><a href="#ä¸»è¦åŠŸèƒ½" class="headerlink" title="ä¸»è¦åŠŸèƒ½"></a>ä¸»è¦åŠŸèƒ½</h3><ol><li>é™åˆ¶é€²ç¨‹çµ„ä½¿ç”¨çš„è³‡æºæ•¸é‡ï¼ˆ Resource limitation ï¼‰ï¼šå¯ä»¥ç‚ºé€²ç¨‹çµ„è¨­å®šè³‡æºä½¿ç”¨ä¸Šé™ï¼Œä¾‹å¦‚memoryã€‚</li><li>é€²ç¨‹çµ„å„ªå…ˆç´šæ§åˆ¶ï¼ˆ Prioritization ï¼‰ï¼šå¯ä»¥ç‚ºé€²ç¨‹çµ„åˆ†é…ç‰¹å®šCPUã€ç£ç›¤IOååé‡</li><li>è¨˜éŒ„é€²ç¨‹çµ„ä½¿ç”¨çš„è³‡æºæ•¸é‡ï¼ˆ Accounting ï¼‰ï¼šä¾‹å¦‚ä½¿ç”¨è¨˜éŒ„æŸå€‹é€²ç¨‹çµ„ä½¿ç”¨çš„CPUæ™‚é–“</li><li>é€²ç¨‹çµ„æ§åˆ¶ï¼ˆ Control ï¼‰ï¼šå¯ä»¥å°‡é€²ç¨‹çµ„æ›èµ·å’Œæ¢å¾©</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#æŸ¥çœ‹cgroupså¯æ§åˆ¶çš„è³‡æºï¼š</span><br><span class="hljs-built_in">ls</span> /sys/fs/cgroup/ -l <br>docker update --<span class="hljs-built_in">help</span> <span class="hljs-comment">#å¯æŸ¥çœ‹ç›¸é—œæŒ‡ä»¤</span><br></code></pre></td></tr></table></figure><p><img src="/img/docker/3-%E5%AE%B9%E5%99%A8%E7%AE%A1%E7%90%86/Untitled%201.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p><blockquote><p>blkio ï¼šå°å¡Šè¨­å‚™çš„IOé€²è¡Œé™åˆ¶ã€‚<br>cpuï¼šé™åˆ¶CPUæ™‚é–“ç‰‡çš„åˆ†é…ï¼Œèˆ‡cpuacctæ›è¼‰åŒä¸€å±¤ç›®éŒ„ã€‚<br>cpuacct ï¼šç”Ÿæˆcgroupä¸­çš„ä»»å‹™ä½”ç”¨CPUè³‡æºçš„å ±å‘Šï¼Œèˆ‡cpuæ›è¼‰åŒä¸€ç›®éŒ„ã€‚<br>cpuset ï¼šçµ¦cgroupä¸­çš„ä»»å‹™åˆ†é…ç¨ç«‹çš„CPUï¼ˆå¤šæ ¸è™•ç†å™¨ï¼‰å’Œmemoryç¯€é»ã€‚<br>devices ï¼šå…è¨±æˆ–è‘—æ‹’çµ• cgroup ä¸­çš„ä»»å‹™è¨ªå•è¨­å‚™ã€‚<br>freezer ï¼šæš«åœ&#x2F;æ¢å¾© cgroup ä¸­çš„ä»»å‹™ã€‚<br>hugetlb ï¼šé™åˆ¶ä½¿ç”¨çš„memoryé æ•¸é‡ã€‚<br>memory ï¼šå°cgroup ä¸­ä»»å‹™çš„å¯ç”¨memoryé€²è¡Œé™åˆ¶ï¼Œä¸¦è‡ªå‹•ç”Ÿæˆè³‡æºä½”ç”¨å ±å‘Šã€‚<br>net_cls ï¼šä½¿ç”¨ç­‰ç´šè­˜åˆ¥ç¬¦ï¼ˆclassidï¼‰æ¨™è¨˜ç¶²çµ¡æ•¸æ“šåŒ…ï¼Œé€™è®“ Linux æµé‡æ§è£½ç¨‹åºï¼ˆtcï¼‰å¯ä»¥è­˜åˆ¥ä¾†è‡ª   ç‰¹å®šå¾cgroup ä»»å‹™çš„æ•¸æ“šåŒ…ï¼Œä¸¦é€²è¡Œç¶²çµ¡é™åˆ¶ã€‚<br>net_prioï¼šå…è¨±åŸºæ–¼cgroupè¨­ç½®ç¶²çµ¡æµé‡çš„å„ªå…ˆç´šã€‚<br>perf_eventï¼šå…è¨±ä½¿ç”¨perfå·¥å…·ä¾†ç›£æ§cgroupã€‚<br>pidsï¼šé™åˆ¶ä»»å‹™çš„æ•¸é‡ã€‚</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>å­¸ç¿’ç­†è¨˜</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Docker å®¹å™¨æ•¸æ“šæŒä¹…åŒ–</title>
    <link href="/2023/04/02/docker/4-%E5%AE%B9%E5%99%A8%E6%95%B8%E6%93%9A%E6%8C%81%E4%B9%85%E5%8C%96/"/>
    <url>/2023/04/02/docker/4-%E5%AE%B9%E5%99%A8%E6%95%B8%E6%93%9A%E6%8C%81%E4%B9%85%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<hr><span id="more"></span><h3 id="ç•¶å®¹å™¨åˆªé™¤æ™‚-å®¹å™¨å…§çš„æ•¸æ“šä¹Ÿæœƒè¢«åˆªé™¤-å¦‚æœéœ€è¦ä¿ç•™æ•¸æ“šçš„è©±å°±éœ€è¦å°‡æ•¸æ“šæ›è¼‰åˆ°æœ¬åœ°ã€‚"><a href="#ç•¶å®¹å™¨åˆªé™¤æ™‚-å®¹å™¨å…§çš„æ•¸æ“šä¹Ÿæœƒè¢«åˆªé™¤-å¦‚æœéœ€è¦ä¿ç•™æ•¸æ“šçš„è©±å°±éœ€è¦å°‡æ•¸æ“šæ›è¼‰åˆ°æœ¬åœ°ã€‚" class="headerlink" title="ç•¶å®¹å™¨åˆªé™¤æ™‚,å®¹å™¨å…§çš„æ•¸æ“šä¹Ÿæœƒè¢«åˆªé™¤,å¦‚æœéœ€è¦ä¿ç•™æ•¸æ“šçš„è©±å°±éœ€è¦å°‡æ•¸æ“šæ›è¼‰åˆ°æœ¬åœ°ã€‚"></a>ç•¶å®¹å™¨åˆªé™¤æ™‚,å®¹å™¨å…§çš„æ•¸æ“šä¹Ÿæœƒè¢«åˆªé™¤,å¦‚æœéœ€è¦ä¿ç•™æ•¸æ“šçš„è©±å°±éœ€è¦å°‡æ•¸æ“šæ›è¼‰åˆ°æœ¬åœ°ã€‚</h3><h2 id="Dockeræä¾›ä»¥ä¸‹ä¸‰ç¨®æ–¹å¼å°‡æ•¸æ“šå¾å®¿ä¸»æ©Ÿæ›è¼‰åˆ°å®¹å™¨ä¸­"><a href="#Dockeræä¾›ä»¥ä¸‹ä¸‰ç¨®æ–¹å¼å°‡æ•¸æ“šå¾å®¿ä¸»æ©Ÿæ›è¼‰åˆ°å®¹å™¨ä¸­" class="headerlink" title="Dockeræä¾›ä»¥ä¸‹ä¸‰ç¨®æ–¹å¼å°‡æ•¸æ“šå¾å®¿ä¸»æ©Ÿæ›è¼‰åˆ°å®¹å™¨ä¸­:"></a>Dockeræä¾›ä»¥ä¸‹ä¸‰ç¨®æ–¹å¼å°‡æ•¸æ“šå¾å®¿ä¸»æ©Ÿæ›è¼‰åˆ°å®¹å™¨ä¸­:</h2><p><img src="/img/docker/4-%E5%AE%B9%E5%99%A8%E6%95%B8%E6%93%9A%E6%8C%81%E4%B9%85%E5%8C%96/Untitled.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p><ul><li><strong>volume</strong> : Dockerç®¡ç†å®¿ä¸»æ©Ÿæ–‡ä»¶ç³»çµ±çš„ä¸€éƒ¨åˆ†( &#x2F;var&#x2F;lib&#x2F;docker&#x2F;volumes)ã€‚<ul><li>æ‡‰ç”¨å ´æ™¯ï¼š<ul><li>å¤šå€‹é‹è¡Œå®¹å™¨é–“å…±äº«æ•¸æ“š</li><li>ç•¶Dockerä¸»æ©Ÿä¸ç¢ºä¿å…·æœ‰çµ¦å®šçš„ç›®éŒ„æˆ–æ–‡ä»¶æ™‚ã€‚å·å¯ä»¥å°‡å®¹å™¨é‹è¡Œæ™‚èˆ‡Dockerä¸»æ©Ÿçš„é…ç½®è§£è€¦åˆ</li><li>å‚™ä»½ã€æ¢å¾©ã€æˆ–å°‡æ•¸æ“šå¾ä¸€å€‹Dockerä¸»æ©Ÿé·ç§»åˆ°å¦ä¸€å€‹Dockerä¸»æ©Ÿæ™‚</li></ul></li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#å‰µå»ºå®¹å™¨å»ºç«‹volume</span><br>docker volume create<br></code></pre></td></tr></table></figure><ul><li><strong>bind mounts</strong> : å°‡å®¿ä¸»æ©Ÿä¸Šä»»æ„ä½ç½®çš„æ–‡ä»¶æˆ–ç›®éŒ„å¼•ç”¨åˆ°å®¹å™¨ä¸­ï¼Œåœ¨ä½¿ç”¨ç¶å®šæ›è¼‰æ™‚ï¼Œé€™äº›ç›®éŒ„æˆ–æ–‡ä»¶ä¸ä¸€å®šè¦å­˜åœ¨ï¼Œå¯æ›è¼‰å¤šå€‹ç›®éŒ„ã€‚<ul><li>æ‡‰ç”¨å ´æ™¯ï¼š<ul><li>ä¸»æ©Ÿèˆ‡å®¹å™¨å…±äº«æ–‡ä»¶ï¼ˆDockeré è¨­æƒ…æ³ä¸‹é€šéé€™ç¨®æ–¹å¼ç‚ºå®¹å™¨æä¾›DNSè§£æï¼Œé€šéå°‡&#x2F;etc&#x2F;resolv.confæ›è¼‰åˆ°å®¹å™¨ä¸­ï¼‰</li><li>å…±äº«æºç¨‹å¼æˆ–build artifactsï¼ˆæ¯”å¦‚å°‡Mavençš„target&#x2F;ç›®éŒ„æ›è¼‰åˆ°å®¹å™¨ä¸­ï¼Œæ¯æ¬¡åœ¨Dockerä¸»æ©Ÿä¸­build Mavenæ™‚ï¼Œå®¹å™¨èƒ½å¤ è¨ªå•åˆ°é‚£äº›rebuilt artifactsï¼‰</li><li>ç•¶dockerä¸»æ©Ÿä¸­çš„æ–‡ä»¶æˆ–ç›®éŒ„çµæ§‹å’Œå®¹å™¨éœ€è¦çš„ä¸€è‡´æ™‚</li></ul></li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker run -d -it --name devtest --mount <span class="hljs-built_in">type</span>=<span class="hljs-built_in">bind</span>,<span class="hljs-built_in">source</span>=<span class="hljs-string">&quot;<span class="hljs-subst">$(pwd)</span>&quot;</span>/target,target=/app --mount <span class="hljs-built_in">type</span>=<span class="hljs-built_in">bind</span>,<span class="hljs-built_in">source</span>=<span class="hljs-string">&quot;<span class="hljs-subst">$(pwd)</span>&quot;</span>/target,target=/app2,<span class="hljs-built_in">readonly</span>,bind-propagation=rslave    nginx:latest<br></code></pre></td></tr></table></figure><ul><li><strong>tmpfs</strong> : æ›è¼‰å­˜å„²åœ¨ä¸»æ©Ÿç³»çµ±çš„å…§å­˜ä¸­ï¼Œè€Œä¸æœƒå¯«å…¥ä¸»æ©Ÿçš„æ–‡ä»¶ç³»çµ±ã€‚å¦‚æœä¸å¸Œæœ›å°‡æ•¸æ“šæŒä¹…å­˜å„²åœ¨ä»»ä½•ä½ç½®ï¼Œå¯ä»¥ä½¿ç”¨tmpfsï¼ŒåŒæ™‚é¿å…å¯«å…¥å®¹å™¨å¯å¯«å±¤æé«˜æ€§èƒ½<ul><li>æ‡‰ç”¨å ´æ™¯ï¼š<ul><li>æœ€å¥½çš„ä½¿ç”¨å ´æ™¯æ˜¯æ—¢ä¸æƒ³å°‡æ•¸æ“šå­˜æ–¼ä¸»æ©Ÿï¼Œåˆä¸æƒ³å­˜æ–¼å®¹å™¨ä¸­æ™‚ã€‚é€™å¯ä»¥æ˜¯å‡ºæ–¼å®‰å…¨çš„è€ƒæ…®ï¼Œæˆ–ç•¶æ‡‰ç”¨éœ€è¦å¯«å¤§é‡éæŒä¹…æ€§çš„ç‹€æ…‹æ•¸æ“šæ™‚ç‚ºäº†ä¿è­·å®¹å™¨çš„æ€§èƒ½</li></ul></li></ul></li></ul>]]></content>
    
    
    <categories>
      
      <category>å­¸ç¿’ç­†è¨˜</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Docker é¡åƒç®¡ç†</title>
    <link href="/2023/04/01/docker/2-Docker%20%E9%8F%A1%E5%83%8F%E7%AE%A1%E7%90%86/"/>
    <url>/2023/04/01/docker/2-Docker%20%E9%8F%A1%E5%83%8F%E7%AE%A1%E7%90%86/</url>
    
    <content type="html"><![CDATA[<hr><span id="more"></span><h1 id="Docker-é¡åƒç®¡ç†"><a href="#Docker-é¡åƒç®¡ç†" class="headerlink" title="Docker é¡åƒç®¡ç†"></a>Docker é¡åƒç®¡ç†</h1><h1 id="é¡åƒ"><a href="#é¡åƒ" class="headerlink" title="é¡åƒ"></a>é¡åƒ</h1><ul><li>åˆ†å±¤å­˜å„²çš„æ–‡ä»¶</li><li>è»Ÿé«”æ‡‰ç”¨çš„ç’°å¢ƒ</li><li>å–®ä¸€é¡åƒå¯å‰µå»ºå¤šå€‹å®¹å™¨(ç›¸ç•¶æ–¼æ¨¡æ¿)</li><li>ä¸éœ€ä¾è³´Linuxå…§æ ¸è€Œåˆç²¾ç°¡çš„Linuxæ“ä½œç³»çµ±</li></ul><hr><h1 id="é¡åƒèˆ‡å®¹å™¨"><a href="#é¡åƒèˆ‡å®¹å™¨" class="headerlink" title="é¡åƒèˆ‡å®¹å™¨"></a>é¡åƒèˆ‡å®¹å™¨</h1><ul><li>é¡åƒ é¡ä¼¼æ–¼è™›æ“¬æ©Ÿé¡åƒ,ä¸€å€‹åª<strong>è®€</strong>æ¨¡æ¿</li><li>å®¹å™¨ é€šéé¡åƒå‰µå»ºçš„å¯¦ä¾‹</li></ul><p><img src="/img/docker/2-%E9%8F%A1%E5%83%8F%E7%AE%A1%E7%90%86/Untitled.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#æŸ¥çœ‹docker </span><br>docker info<br><br>Server Version: 20.10.9  <span class="hljs-comment">#ç›®å‰ç‰ˆæœ¬</span><br>Storage Driver: overlay2 <span class="hljs-comment">#å­˜å„²é©…å‹• (imageçš„å­˜æ”¾ä½ç½®: var/lib/docker/é©…å‹•ç›®éŒ„)</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#æ‹‰å–é¡åƒ</span><br>docker pull <span class="hljs-string">&quot;image:tag&quot;</span><br><span class="hljs-comment">#æŸ¥çœ‹é¡åƒ</span><br>docker images<br><span class="hljs-comment">#å‰µå»ºå®¹å™¨,é‹è¡Œ</span><br>docker run -d --name <span class="hljs-string">&quot;è‡ªå®šç¾©åç¨±&quot;</span> <span class="hljs-string">&quot;é¡åƒå&quot;</span><br><span class="hljs-comment">#æŸ¥çœ‹å®¹å™¨</span><br>docker ps<br></code></pre></td></tr></table></figure><hr><h1 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h1><table><thead><tr><th>docker</th><th>image &lt;å‘½ä»¤&gt;</th></tr></thead><tbody><tr><td>å‘½ä»¤</td><td>æè¿°</td></tr><tr><td>ls</td><td>åˆ—å‡ºé¡åƒ</td></tr><tr><td>build</td><td>å»ºæ§‹é¡åƒ(Dockerfile)</td></tr><tr><td>history</td><td>æŸ¥çœ‹é¡åƒæ­·å²</td></tr><tr><td>inspect</td><td>é¡¯ç¤ºé¡åƒè©³ç´°è¨Šæ¯</td></tr><tr><td>pull</td><td>å¾é¡åƒå€‰åº«æ‹‰å–é¡åƒ</td></tr><tr><td>push</td><td>æ¨é€ä¸€å€‹é¡åƒåˆ°é¡åƒå€‰åº«</td></tr><tr><td>rm</td><td>åˆªé™¤é¡åƒ</td></tr><tr><td>prune</td><td>ç§»é™¤æ²’æœ‰è¢«æ¨™è¨˜æˆ–è‘—æ²’æœ‰è¢«å®¹å™¨å¼•ç”¨çš„é¡åƒ</td></tr><tr><td>tag</td><td>å‰µå»ºä¸€å€‹å¼•ç”¨æºé¡åƒ,æ¨™è¨˜é¡åƒ</td></tr><tr><td>export</td><td>å°å‡ºå®¹å™¨æ–‡ä»¶ç³»çµ±åˆ°taræ­¸æª”æ–‡ä»¶</td></tr><tr><td>import</td><td>å°å…¥å®¹å™¨æ–‡ä»¶ç³»çµ±taræ­¸æª”æ–‡ä»¶å‰µå»ºé¡åƒ</td></tr><tr><td>save</td><td>ä¿å­˜ä¸€å€‹æˆ–å¤šå€‹é¡åƒåˆ°ä¸€å€‹taræ­¸æª”æ–‡ä»¶</td></tr><tr><td>load</td><td>åŠ è¼‰é¡åƒä¾†è‡ªtaræ­¸æª”æˆ–æ¨™æº–è¼¸å…¥</td></tr></tbody></table><h1 id="é¡åƒå­˜å„²-è¯åˆæ–‡ä»¶ç³»çµ±-UnionFS"><a href="#é¡åƒå­˜å„²-è¯åˆæ–‡ä»¶ç³»çµ±-UnionFS" class="headerlink" title="é¡åƒå­˜å„²:è¯åˆæ–‡ä»¶ç³»çµ±(UnionFS)"></a>é¡åƒå­˜å„²:è¯åˆæ–‡ä»¶ç³»çµ±(UnionFS)</h1><p>ç›¸è¼ƒæ–¼è™›æ“¬æ©Ÿä¸€å€‹ç’°å¢ƒè£¡ç¨ç«‹çš„é¡åƒæ–‡ä»¶,dockerå‰‡å¼•ç”¨è¯åˆæ–‡ä»¶ç³»çµ±,å°‡å¤šå±¤æ–‡ä»¶è¯åˆæ›è¼‰åˆ°ä¸€å€‹å®¹å™¨æ–‡ä»¶ç³»çµ±ã€‚</p><hr><p><img src="/img/docker/2-%E9%8F%A1%E5%83%8F%E7%AE%A1%E7%90%86/Untitled%201.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p><hr><h1 id="é¡åƒå­˜å„²-å¯«æ™‚è¤‡è£½"><a href="#é¡åƒå­˜å„²-å¯«æ™‚è¤‡è£½" class="headerlink" title="é¡åƒå­˜å„²:å¯«æ™‚è¤‡è£½"></a>é¡åƒå­˜å„²:å¯«æ™‚è¤‡è£½</h1><p>é¡åƒåªä¾›è®€å–,ä»¥å…±äº«çš„å½¢å¼ä¾›å¤šå€‹å®¹å™¨ä½¿ç”¨,å¦‚æœéœ€è¦åœ¨å®¹å™¨ä¿®æ”¹æ–‡ä»¶(å³é¡åƒè£¡çš„æ–‡ä»¶),dockerå¼•ç”¨äº†å¯«æ™‚è¤‡è£½(copy on write),å°‡é¡åƒè£¡çš„æ–‡ä»¶è¤‡è£½åˆ°å®¹å™¨çš„æ–‡ä»¶ç³»çµ±é€²è¡Œä¿®æ”¹ã€‚</p><p><img src="/img/docker/2-%E9%8F%A1%E5%83%8F%E7%AE%A1%E7%90%86/Untitled%202.png" srcset="/img/loading.gif" lazyload alt="Untitled"></p>]]></content>
    
    
    <categories>
      
      <category>å­¸ç¿’ç­†è¨˜</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Docker æ¦‚è¿°</title>
    <link href="/2023/04/01/docker/1-Docker%20%E6%A6%82%E8%BF%B0%20/"/>
    <url>/2023/04/01/docker/1-Docker%20%E6%A6%82%E8%BF%B0%20/</url>
    
    <content type="html"><![CDATA[<hr><span id="more"></span><h1 id="Why"><a href="#Why" class="headerlink" title="Why?"></a>Why?</h1><ul><li><p>ä¸Šç·šæµç¨‹ç¹ç‘£</p><p>  é–‹ç™¼ â†’ æ¸¬è©¦ â†’ ç”³è«‹è³‡æº â†’ å¯©æ‰¹ â†’ éƒ¨ç½² â†’ æ¸¬è©¦â€¦ç­‰ç’°ç¯€</p></li><li><p>è³‡æºåˆ©ç”¨ç‡ä½</p><p>  æ™®éæœå‹™å™¨åˆ©ç”¨ç‡ä½,é€ æˆéå¤šæµªè²»</p></li><li><p>æ“´å®¹&#x2F;ç¸®å®¹ä¸åŠæ™‚</p><p>  æ¥­å‹™é«˜å³°æœŸæ“´å®¹æµç¨‹ç¹ç‘£,ä¸Šç·šä¸åŠæ™‚</p></li><li><p>æœå‹™æ°£ç’°å¢ƒè‡ƒè…«</p><p>  æœå‹™å™¨è‡ƒè…«,å°å¾ŒæœŸç¶­è­·ã€é·ç§»é€ æˆè«¸å¤šä¸ä¾¿</p></li><li><p>ç’°å¢ƒä¸ä¸€è‡´</p></li></ul><hr><h1 id="What"><a href="#What" class="headerlink" title="What?"></a>What?</h1><ul><li>æ“ä½œç³»çµ±ç´šçš„è™›æ“¬åŒ–æŠ€è¡“</li><li>ä¾è³´linuxç‰¹æ€§: Namespace(è³‡æºéš”é›¢), Cgroups(è³‡æºé™åˆ¶)</li><li>ç°¡å–®çš„æ‡‰ç”¨ç¨‹å¼æ‰“åŒ…å·¥å…·</li></ul><hr><h1 id="å®¹å™¨VSè™›æ“¬åŒ–"><a href="#å®¹å™¨VSè™›æ“¬åŒ–" class="headerlink" title="å®¹å™¨VSè™›æ“¬åŒ–"></a>å®¹å™¨VSè™›æ“¬åŒ–</h1><h3 id="å®¹å™¨"><a href="#å®¹å™¨" class="headerlink" title="å®¹å™¨"></a>å®¹å™¨</h3><ol><li>å®¹å™¨æä¾›ä¸€å€‹ç¨ç«‹çš„ç’°å¢ƒ,å¯¦è¸ç’°å¢ƒéš”é›¢ã€è³‡æºé™åˆ¶</li><li>ä¸»è¦è§£æ±ºæ‡‰ç”¨å±¤å•é¡Œ,ä¾¿æ–¼å¿«é€Ÿéƒ¨ç½²ã€é«˜æ•ˆç®¡ç†</li></ol><h3 id="è™›æ“¬åŒ–"><a href="#è™›æ“¬åŒ–" class="headerlink" title="è™›æ“¬åŒ–"></a>è™›æ“¬åŒ–</h3><ol><li>æä¾›æœå‹™å™¨è³‡æºåˆ©ç”¨ç‡</li><li>å®Œå…¨éš”é›¢çš„ç’°å¢ƒ</li></ol><h1 id="å®‰è£Docker"><a href="#å®‰è£Docker" class="headerlink" title="å®‰è£Docker"></a>å®‰è£Docker</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ·»åŠ Docker yumæº</span><br>yum-config-manager \<br>--add-repo \<br>https://download.docker.com/linux/centos/docker-ce.repo<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#å®‰è£ä¾è³´åŒ…</span><br>yum install -y yum-utils<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#å®‰è£DockerCE</span><br>yum install docker-ce docker-ce-cli containerd.io -y<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#å•Ÿå‹•Dockeræœå‹™ä¸¦è¨­ç½®é–‹æ©Ÿå•Ÿå‹•</span><br>systemctl start docker<br>systemctl <span class="hljs-built_in">enable</span> docker<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>å­¸ç¿’ç­†è¨˜</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
